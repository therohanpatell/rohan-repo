Test_ID,Category,Subcategory,Test_Case_Name,Test_Type,Description,Input,Expected_Output,Validation_Method,Priority,Status
1.1,Schema Conversion,Data Type Mapping,Test All Supported Data Type Mappings,Positive,Verify correct BigQuery to Spark type conversion,BigQuery schema with STRING/INTEGER/FLOAT/NUMERIC/BOOLEAN/DATE/TIMESTAMP,Spark StructType with correct type mappings,Assert each field type matches expected Spark type,High,Pending
1.2,Schema Conversion,Nullable Fields,Test Nullable Field Preservation,Positive,Verify nullable fields are correctly marked,BigQuery schema with mix of nullable and required fields,Spark StructType preserves nullable=True/False,Assert nullable property matches for all fields,High,Pending
1.3,Schema Conversion,Required Fields,Test Required Field Preservation,Positive,Verify required fields are correctly marked,BigQuery schema with required fields (mode='REQUIRED'),Spark StructType with nullable=False,Assert required fields have nullable=False,High,Pending
1.4,Schema Conversion,Simple Schema,Test Simple Table Schema (3-5 columns),Positive,Fetch schema for simple table,Table with 3 columns (id/name/created_date),Spark StructType with 3 fields correctly mapped,Assert field count and types match,High,Pending
1.5,Schema Conversion,Complex Schema,Test Complex Table Schema (20+ columns),Positive,Fetch schema for complex table,Table with 25 columns of various types,Spark StructType with all 25 fields correctly mapped,Assert all fields present and correctly typed,Medium,Pending
1.6,Schema Conversion,Error Handling,Test Non-Existent Table,Negative,Attempt to fetch schema for non-existent table,Invalid table name project.dataset.nonexistent_table,BigQueryError raised with clear message,Assert exception type and error message,High,Pending
1.7,Schema Conversion,Error Handling,Test Invalid Table Name Format,Negative,Provide malformed table name,invalid_table_name (missing project/dataset),BigQueryError or ValidationError raised,Assert exception with helpful error message,High,Pending
1.8,Schema Conversion,Error Handling,Test Unsupported Data Type,Negative,Table contains unsupported BigQuery type,BigQuery schema with GEOGRAPHY or ARRAY type,BigQueryError or default to StringType with warning,Assert error handling or fallback behavior,Medium,Pending
1.9,Schema Conversion,Edge Cases,Test Empty Schema,Negative,Table exists but has no columns,Table with 0 columns,BigQueryError or empty StructType,Assert appropriate handling,Low,Pending
1.10,Schema Conversion,Error Handling,Test Permission Denied,Negative,User lacks permission to access table,Table user doesn't have access to,BigQueryError with permission denied message,Assert exception contains permission error,Medium,Pending
2.1,Multi-Record SQL,Single Record,Test Single Record Return,Positive,SQL query returns exactly 1 record,SQL query returning 1 row with 5 columns,List with 1 dictionary containing all 5 columns,Assert len(result) == 1 and all columns present,High,Pending
2.2,Multi-Record SQL,Multiple Records,Test Multiple Records Return (Small),Positive,SQL query returns 10 records,SQL query returning 10 rows,List with 10 dictionaries,Assert len(result) == 10 and structure consistent,High,Pending
2.3,Multi-Record SQL,Multiple Records,Test Multiple Records Return (Medium),Positive,SQL query returns 1000 records,SQL query returning 1000 rows,List with 1000 dictionaries,Assert len(result) == 1000,Medium,Pending
2.4,Multi-Record SQL,Multiple Records,Test Multiple Records Return (Large),Positive,SQL query returns 100000 records,SQL query returning 100000 rows,List with 100000 dictionaries,Assert len(result) == 100000 and performance acceptable,Medium,Pending
2.5,Multi-Record SQL,Data Types,Test All Column Types in Results,Positive,SQL returns columns of all supported types,SQL with STRING/INTEGER/FLOAT/DECIMAL/BOOLEAN/DATE/TIMESTAMP,List of dictionaries with correct Python types,Assert type(value) matches expected Python type,High,Pending
2.6,Multi-Record SQL,NULL Handling,Test NULL Values in Results,Positive,SQL returns records with NULL values,SQL returning rows with some NULL columns,List of dictionaries with None for NULL values,Assert NULL columns have None value,High,Pending
2.7,Multi-Record SQL,Dynamic Columns,Test Dynamic Column Names,Positive,SQL returns columns with various names,SQL with columns: custom_metric/user_count/avg_value,List of dictionaries with exact column names from SQL,Assert dictionary keys match SQL column names,High,Pending
2.8,Multi-Record SQL,Empty Results,Test Empty Result Set,Negative,SQL query returns 0 records,SQL query with WHERE clause matching no rows,Empty list [],Assert len(result) == 0 and no error raised,High,Pending
2.9,Multi-Record SQL,Error Handling,Test SQL Syntax Error,Negative,Invalid SQL syntax,SELCT * FROM table (typo),SQLExecutionError raised with syntax error details,Assert exception type and error category,High,Pending
2.10,Multi-Record SQL,Error Handling,Test SQL Timeout,Negative,SQL query exceeds timeout limit,SQL query running longer than 180 seconds,SQLExecutionError raised with timeout error,Assert exception type and error category,Medium,Pending
2.11,Multi-Record SQL,Error Handling,Test Table Not Found in SQL,Negative,SQL references non-existent table,SELECT * FROM project.dataset.nonexistent,SQLExecutionError raised with table not found error,Assert exception contains table name,High,Pending
2.12,Multi-Record SQL,Error Handling,Test Column Not Found in SQL,Negative,SQL references non-existent column,SELECT nonexistent_column FROM table,SQLExecutionError raised with column error,Assert exception contains column name,Medium,Pending
2.13,Multi-Record SQL,Performance,Test Extremely Large Result Set,Negative,SQL query returns 1000000+ records,SQL returning over 1 million rows,Successful processing or graceful memory error,Assert memory handling or appropriate error,Low,Pending
3.1,Schema Caching,Cache Miss,Test Cache Miss (First Access),Positive,First time accessing schema for a table,Target table not in cache,Schema fetched from BigQuery and stored in cache,Assert schema_cache contains table after call,High,Pending
3.2,Schema Caching,Cache Hit,Test Cache Hit (Subsequent Access),Positive,Second access to same table schema,Target table already in cache,Schema returned from cache without BigQuery call,Assert BigQuery method not called,High,Pending
3.3,Schema Caching,Multiple Tables,Test Multiple Tables Caching,Positive,Cache schemas for 5 different tables,5 unique target tables,All 5 schemas cached independently,Assert schema_cache has 5 entries,Medium,Pending
3.4,Schema Caching,Cache Reuse,Test Cache Reuse Across Metrics,Positive,10 metrics targeting same table,10 metrics with same target_table,Schema fetched once and reused 9 times,Assert BigQuery called once,High,Pending
3.5,Schema Caching,Error Handling,Test Cache with Invalid Table,Negative,Attempt to cache schema for non-existent table,Invalid target table name,BigQueryError raised and nothing cached,Assert exception raised and cache empty,Medium,Pending
3.6,Schema Caching,Error Handling,Test Cache After Schema Fetch Failure,Negative,Schema fetch fails and verify cache state,Table with permission denied,Error raised and no cache entry created,Assert table not in cache after failure,Medium,Pending
4.1,Schema Alignment,Perfect Match,Test Perfect Schema Match,Positive,DataFrame columns exactly match target table,DataFrame with all required columns and correct types,DataFrame returned unchanged,Assert all columns present and types correct,High,Pending
4.2,Schema Alignment,Extra Columns,Test Extra Columns Dropped,Positive,DataFrame has columns not in target table,DataFrame with 10 columns and target table has 8,2 extra columns dropped and 8 retained,Assert final DataFrame has exactly 8 columns,High,Pending
4.3,Schema Alignment,Missing Columns,Test Missing Nullable Columns Added,Positive,DataFrame missing nullable columns from target,DataFrame missing 2 nullable columns,2 columns added with NULL values,Assert columns added with None values,High,Pending
4.4,Schema Alignment,Type Conversion,Test Type Conversion (String to Date),Positive,DataFrame has string column and target expects DATE,DataFrame with '2024-01-15' as string,Column converted to DateType,Assert column type is DateType after alignment,Medium,Pending
4.5,Schema Alignment,Type Conversion,Test Type Conversion (Integer to Decimal),Positive,DataFrame has integer and target expects NUMERIC,DataFrame with IntegerType,Column converted to DecimalType,Assert column type is DecimalType,Medium,Pending
4.6,Schema Alignment,Column Order,Test Column Reordering,Positive,DataFrame columns in different order than target,DataFrame with columns [C/A/B] and target has [A/B/C],Columns reordered to match target [A/B/C],Assert column order matches target schema,Medium,Pending
4.7,Schema Alignment,Error Handling,Test Missing Required Column,Negative,DataFrame missing required column,DataFrame missing 'metric_id' (required column),ValidationError raised with missing column details,Assert exception message lists 'metric_id',High,Pending
4.8,Schema Alignment,Error Handling,Test Multiple Missing Required Columns,Negative,DataFrame missing 3 required columns,DataFrame missing metric_id/metric_name/metric_output,ValidationError with all 3 columns listed,Assert exception contains all missing columns,High,Pending
4.9,Schema Alignment,Error Handling,Test Type Conversion Failure,Negative,Cannot convert column to target type,DataFrame with 'invalid_date' string,ValidationError or type conversion error,Assert exception with column name and type,Medium,Pending
4.10,Schema Alignment,Edge Cases,Test Empty DataFrame,Negative,DataFrame has 0 rows,Empty DataFrame with schema,Empty DataFrame returned with aligned schema,Assert schema aligned but row count remains 0,Low,Pending
4.11,Schema Alignment,Error Handling,Test All Columns Missing,Negative,DataFrame has completely different columns,DataFrame with [X/Y/Z] and target expects [A/B/C],ValidationError for missing required columns,Assert exception lists all required missing columns,High,Pending
5.1,End-to-End,Single Metric,Test Single Metric Single Record,Positive,Process 1 metric returning 1 record,1 JSON metric with SQL returning 1 row,1 record written and 1 recon record created,Assert write_results contains 1 success,High,Pending
5.2,End-to-End,Single Metric,Test Single Metric Multiple Records,Positive,Process 1 metric returning 100 records,1 JSON metric with SQL returning 100 rows,100 records written and 1 recon record created,Assert write_results shows 100 records written,High,Pending
5.3,End-to-End,Multiple Metrics,Test Multiple Metrics Same Table,Positive,Process 5 metrics targeting same table,5 metrics with same target_table,Schema fetched once and all 5 metrics processed,Assert schema cache hit 4 times,High,Pending
5.4,End-to-End,Multiple Metrics,Test Multiple Metrics Different Tables,Positive,Process 5 metrics targeting 5 different tables,5 metrics with unique target_tables,5 schemas fetched and cached,Assert 5 cache entries and all metrics succeed,Medium,Pending
5.5,End-to-End,Data Enrichment,Test Partition Date Added to All Records,Positive,Verify partition_dt added to all SQL result rows,Metric with SQL returning 10 rows,All 10 rows have partition_dt field,Assert all records have partition_dt matching run_date,High,Pending
5.6,End-to-End,Data Enrichment,Test Pipeline Execution Timestamp Added,Positive,Verify pipeline_execution_ts added to all records,Metric with SQL returning 10 rows,All 10 rows have pipeline_execution_ts field,Assert all records have valid timestamp,High,Pending
5.7,End-to-End,Placeholders,Test SQL Placeholder Replacement,Positive,SQL with {currently} placeholder,SQL with WHERE date = {currently},Placeholder replaced with run_date before execution,Assert SQL executed with correct date value,High,Pending
5.8,End-to-End,Placeholders,Test Partition Info Placeholder,Positive,SQL with {partition_info} placeholder,SQL with WHERE partition_dt = {partition_info},Placeholder replaced with partition date from metadata,Assert SQL executed with correct partition date,High,Pending
5.9,End-to-End,Error Handling,Test Schema Fetch Failure for One Metric,Negative,One metric targets non-existent table,3 metrics with 1 invalid target_table,1 metric fails and 2 succeed,Assert 2 success and 1 failure with SCHEMA_VALIDATION_ERROR,High,Pending
5.10,End-to-End,Error Handling,Test SQL Execution Failure for One Metric,Negative,One metric has invalid SQL,3 metrics with 1 SQL syntax error,1 metric fails and 2 succeed,Assert 2 success and 1 failure with SQL_SYNTAX_ERROR,High,Pending
5.11,End-to-End,Error Handling,Test Missing Required Columns in SQL Results,Negative,SQL doesn't return required columns,Metric with SQL missing 'metric_id' column,Metric fails with schema validation error,Assert failure with missing column details,High,Pending
5.12,End-to-End,Error Handling,Test All Metrics Fail,Negative,All metrics have errors,5 metrics all with invalid SQL or tables,All 5 metrics fail and 5 recon records with 'Failed',Assert 0 success and 5 failures,Medium,Pending
5.13,End-to-End,Empty Results,Test Empty SQL Result Set,Negative,SQL returns 0 rows,Metric with SQL WHERE clause matching nothing,0 records written and recon record shows 0 records,Assert write_results shows 0 records,Medium,Pending
5.14,End-to-End,Error Handling,Test Type Mismatch in SQL Results,Negative,SQL returns wrong type for column,SQL returns string for column expecting integer,Type conversion attempted or validation error,Assert error handling or successful conversion,Medium,Pending
6.1,Recon Records,Success Cases,Test Recon Record for Successful Metric,Positive,Verify recon record created for successful metric,Metric successfully written to target table,Recon record with rcncln_exact_pass_in = 'Passed',Assert recon record has correct status,High,Pending
6.2,Recon Records,Success Cases,Test Recon Record with Multiple Records Written,Positive,Metric writes 100 records,Metric with SQL returning 100 rows,Recon record shows 100 records written,Assert recon record count field = 100,Medium,Pending
6.3,Recon Records,Failure Cases,Test Recon Record for Failed Metric (Schema Error),Positive,Metric fails due to schema validation,Metric with missing required columns,Recon record with 'Failed' status and error details,Assert recon status 'Failed' and error message,High,Pending
6.4,Recon Records,Failure Cases,Test Recon Record for Failed Metric (SQL Error),Positive,Metric fails due to SQL execution error,Metric with invalid SQL,Recon record with 'Failed' status and SQL error details,Assert recon record contains SQL error category,High,Pending
6.5,Recon Records,Schema Validation,Test Recon Schema Unchanged,Positive,Verify RECON_SCHEMA still exists and unchanged,Check config.py,RECON_SCHEMA constant present with all 29 fields,Assert RECON_SCHEMA exists and has correct structure,High,Pending
6.6,Recon Records,Data Quality,Test Recon Record with None Values Prevented,Negative,Ensure no None values in required recon fields,Failed metric with minimal information,Recon record uses 'UNKNOWN' or safe defaults,Assert no None values in required recon fields,High,Pending
6.7,Recon Records,Multiple Failures,Test Recon Record for Multiple Failures,Negative,Metric fails at multiple stages,Metric with schema error AND SQL error,Recon record captures first/primary error,Assert recon record has clear error message,Medium,Pending
7.1,Integration,Backward Compatibility,Test Backward Compatibility with Old JSON,Positive,Run pipeline with existing JSON configurations,JSON files that worked with hardcoded METRICS_SCHEMA,All metrics process successfully,Assert same results as before,High,Pending
7.2,Integration,New Features,Test New JSON with Custom Columns,Positive,Run pipeline with JSON targeting custom table structure,JSON with SQL returning custom columns,All metrics process successfully with custom columns,Assert custom columns written to target table,High,Pending
7.3,Integration,Mixed Scenarios,Test Mixed Metrics (Old and New Structure),Positive,Process metrics with both old and new structures,5 metrics with old structure and 5 with new,All 10 metrics process successfully,Assert all metrics succeed regardless of structure,Medium,Pending
7.4,Integration,Performance,Test Performance with Schema Caching,Positive,Measure BigQuery API calls with caching,20 metrics targeting 3 different tables,Only 3 schema fetch calls (1 per unique table),Assert BigQuery schema fetch called exactly 3 times,High,Pending
7.5,Integration,Error Handling,Test Pipeline with All Invalid Metrics,Negative,Run pipeline where all metrics fail,JSON with all metrics having errors,Pipeline completes and all recon records show 'Failed',Assert pipeline doesn't crash,Medium,Pending
7.6,Integration,Mixed Results,Test Pipeline with Mixed Success and Failure,Negative,Some metrics succeed and some fail,10 metrics with 6 succeed and 4 fail,6 written successfully and 4 recon records with 'Failed',Assert correct count of success/failure,High,Pending
8.1,Logging,Cache Logging,Test Schema Cache Hit Logging,Positive,Verify log message for cache hit,Access cached schema,Log message 'Schema cache hit for table: {table_name}',Assert log contains cache hit message,Low,Pending
8.2,Logging,Cache Logging,Test Schema Cache Miss Logging,Positive,Verify log message for cache miss,Access schema not in cache,Log message 'Schema cache miss for table: {table_name}',Assert log contains cache miss message,Low,Pending
8.3,Logging,Record Count,Test Multi-Record Count Logging,Positive,Verify log message for multiple records,SQL returning 100 records,Log message 'SQL query returned 100 records',Assert log contains record count,Low,Pending
8.4,Logging,Error Logging,Test Schema Validation Error Logging,Negative,Verify detailed error logging for schema validation,Metric with missing required columns,Log contains metric_id/target_table/missing columns,Assert log message has all error details,Medium,Pending
8.5,Logging,Error Categories,Test Error Category Assignment,Negative,Verify SCHEMA_VALIDATION_ERROR category used,Metric with schema validation failure,Error categorized as 'SCHEMA_VALIDATION_ERROR',Assert error_category field in recon record,Medium,Pending
8.6,Logging,Error Sanitization,Test Error Message Sanitization,Negative,Verify error messages cleaned properly,Error with special characters or sensitive data,Error message sanitized using StringUtils,Assert error message is clean and safe,Low,Pending
9.1,Performance,Large Data,Test Large Result Set (100K records),Positive,Process metric returning 100000 records,SQL returning 100000 rows,All records processed and written successfully,Assert performance acceptable (< 5 minutes),Medium,Pending
9.2,Performance,Many Metrics,Test Many Metrics (100 metrics),Positive,Process 100 metrics in single run,JSON with 100 metric definitions,All metrics processed successfully,Assert completion time acceptable,Medium,Pending
9.3,Performance,Cache Efficiency,Test Schema Cache Efficiency,Positive,Measure time saved by caching,50 metrics targeting 5 tables,Significant time savings vs fetching schema 50 times,Assert cache reduces total execution time,Medium,Pending
9.4,Performance,Memory Limits,Test Memory Limit with Huge Result Set,Negative,SQL returning 1000000+ records,SQL with massive result set,Successful processing or graceful memory error,Assert no crash and appropriate error handling,Low,Pending
9.5,Performance,Timeout,Test Timeout Handling,Negative,SQL query exceeds timeout,Complex SQL taking > 180 seconds,Timeout error caught and logged,Assert timeout error category and metric marked failed,Medium,Pending
10.1,Edge Cases,Minimal Schema,Test Single Column Table,Positive,Target table has only 1 column,SQL returning 1 column matching target,Record written successfully,Assert single column handled correctly,Low,Pending
10.2,Edge Cases,Wide Schema,Test Wide Table (50+ columns),Positive,Target table has 50 columns,SQL returning all 50 columns,All columns written successfully,Assert all columns present in target,Low,Pending
10.3,Edge Cases,NULL Data,Test All NULL Result,Positive,SQL returns record with all NULL values,SQL with all columns as NULL,Record written with NULL values,Assert NULLs handled correctly,Low,Pending
10.4,Edge Cases,Schema Mismatch,Test Completely Wrong Schema,Negative,SQL returns columns with no overlap to target,SQL returns [X/Y/Z] and target expects [A/B/C],Validation error for all missing required columns,Assert clear error message listing all missing columns,Medium,Pending
10.5,Edge Cases,Special Characters,Test Special Characters in Column Names,Negative,Table has columns with special characters,Columns like 'metric-id' or 'metric.name',Columns handled correctly or error raised,Assert special characters handled or clear error,Low,Pending
10.6,Edge Cases,Reserved Keywords,Test Reserved Keywords as Column Names,Negative,Table has columns named with SQL reserved words,Columns like 'select' or 'from' or 'where',Columns handled correctly with proper escaping,Assert reserved words handled safely,Low,Pending
