<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Agent Zero â€“ Unified AI Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #050816;
      --bg-soft: #0b1020;
      --accent: #4ade80;
      --accent-soft: rgba(74, 222, 128, 0.18);
      --accent-strong: #22c55e;
      --danger: #f97373;
      --text: #f9fafb;
      --muted: #c7d2fe;
      --border: #1f2937;
      --card-radius: clamp(14px, 1vw, 22px);
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.85);
      --transition: 0.2s ease-in-out;
      
      /* Dynamic font sizes based on viewport */
      --font-title: clamp(28px, 2.5vw, 48px);
      --font-subtitle: clamp(16px, 1.2vw, 24px);
      --font-question: clamp(18px, 1.4vw, 28px);
      --font-option: clamp(16px, 1.2vw, 22px);
      --font-label: clamp(14px, 1vw, 20px);
      --font-small: clamp(12px, 0.9vw, 18px);
      --font-card-title: clamp(18px, 1.4vw, 26px);
      --font-world-btn: clamp(16px, 1.2vw, 22px);
      
      /* Dynamic spacing */
      --spacing-xs: clamp(4px, 0.4vw, 8px);
      --spacing-sm: clamp(8px, 0.6vw, 12px);
      --spacing-md: clamp(12px, 0.8vw, 18px);
      --spacing-lg: clamp(16px, 1vw, 24px);
      --spacing-xl: clamp(20px, 1.2vw, 32px);
    }

    * {
      box-sizing: border-box;
    }

    @keyframes gradient-shift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }

    @keyframes pulse-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(74, 222, 128, 0.4); }
      50% { box-shadow: 0 0 40px rgba(74, 222, 128, 0.8); }
    }

    @keyframes slide-in {
      from { transform: translateX(-20px); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
      20%, 40%, 60%, 80% { transform: translateX(10px); }
    }

    @keyframes shake-screen {
      0%, 100% { transform: translate(0, 0); }
      10%, 30%, 50%, 70%, 90% { transform: translate(-2px, 2px); }
      20%, 40%, 60%, 80% { transform: translate(2px, -2px); }
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }

    @keyframes rotate-glow {
      0% { transform: rotate(0deg); filter: hue-rotate(0deg); }
      100% { transform: rotate(360deg); filter: hue-rotate(360deg); }
    }

    @keyframes scale-pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes slide-up {
      from { transform: translateY(20px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    @keyframes glow-border {
      0%, 100% { box-shadow: 0 0 20px rgba(74, 222, 128, 0.4); }
      50% { box-shadow: 0 0 40px rgba(74, 222, 128, 0.8), 0 0 60px rgba(74, 222, 128, 0.6); }
    }

    @keyframes text-shimmer {
      0% { background-position: -100% 0; }
      100% { background-position: 200% 0; }
    }

    .shake-animation {
      animation: shake 0.5s ease;
    }

    .bounce-animation {
      animation: bounce 0.6s ease;
    }

    .slide-up-animation {
      animation: slide-up 0.5s ease;
    }

    .scale-pulse-animation {
      animation: scale-pulse 0.8s ease infinite;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 25%, #312e81 50%, #1e1b4b 75%, #0f172a 100%);
      background-size: 400% 400%;
      animation: gradient-shift 15s ease infinite;
      color: var(--text);
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .app-shell {
      max-width: 1200px;
      width: 100%;
      margin: 0 auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      height: 100vh;
      overflow: hidden;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      padding: 14px 18px;
      border-radius: 16px;
      border: 2px solid rgba(148, 163, 184, 0.5);
      background: radial-gradient(circle at top left, #111827 0, #020617 45%);
      backdrop-filter: blur(14px);
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
      flex-shrink: 0;
    }

    header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(45deg, transparent, rgba(74, 222, 128, 0.05), transparent);
      pointer-events: none;
      z-index: 0;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title-block h1 {
      margin: 0;
      font-size: var(--font-title);
      letter-spacing: 0.04em;
      text-transform: uppercase;
      background: linear-gradient(90deg, #4ade80, #a78bfa, #fb923c);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      position: relative;
      z-index: 1;
    }

    .title-sub {
      font-size: var(--font-subtitle);
      color: var(--muted);
      font-weight: 500;
    }

    .pill-row {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .pill {
      font-size: var(--font-label);
      padding: var(--spacing-xs) var(--spacing-md);
      border-radius: 999px;
      border: clamp(1px, 0.15vw, 2px) solid rgba(148, 163, 184, 0.6);
      color: var(--muted);
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-sm);
      font-weight: 600;
    }

    .pill span.dot {
      width: clamp(12px, 1vw, 18px);
      height: clamp(12px, 1vw, 18px);
      border-radius: 999px;
      background: radial-gradient(circle, var(--accent-strong), #16a34a);
      box-shadow: 0 0 20px rgba(34, 197, 94, 0.85);
    }

    .meta {
      display: flex;
      flex-direction: column;
      gap: 6px;
      align-items: flex-end;
    }

    .score-chip {
      padding: var(--spacing-sm) var(--spacing-lg);
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: clamp(1px, 0.15vw, 2px) solid rgba(148, 163, 184, 0.7);
      font-size: var(--font-subtitle);
      display: inline-flex;
      gap: var(--spacing-sm);
      align-items: center;
      font-weight: 700;
    }

    .score-chip strong {
      color: var(--accent-strong);
      font-weight: 800;
      font-size: clamp(20px, 1.6vw, 32px);
    }

    .progress-bar-shell {
      width: 180px;
      height: 6px;
      border-radius: 999px;
      background: #020617;
      overflow: hidden;
      border: 1px solid #1f2937;
    }

    .progress-bar-inner {
      height: 100%;
      width: 0%;
      border-radius: 999px;
      background: linear-gradient(90deg, #22c55e, #a855f7);
      transition: width 0.5s ease-out;
      box-shadow: 0 0 20px rgba(34, 197, 94, 0.6);
    }

    main {
      display: grid;
      grid-template-columns: minmax(0, 260px) minmax(0, 1fr);
      gap: 14px;
      flex: 1;
      overflow: hidden;
    }

    @media (max-width: 900px) {
      main {
        grid-template-columns: 1fr;
      }
      .meta {
        align-items: flex-start;
      }
    }

    .worlds-panel {
      border-radius: var(--card-radius);
      background: rgba(15, 23, 42, 0.94);
      border: 2px solid var(--border);
      box-shadow: var(--shadow-soft);
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      position: relative;
      overflow-y: auto;
      overflow-x: hidden;
      max-height: calc(100vh - 180px);
    }

    .worlds-panel::-webkit-scrollbar {
      width: 8px;
    }

    .worlds-panel::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.5);
      border-radius: 4px;
    }

    .worlds-panel::-webkit-scrollbar-thumb {
      background: rgba(74, 222, 128, 0.5);
      border-radius: 4px;
    }

    .worlds-panel::-webkit-scrollbar-thumb:hover {
      background: rgba(74, 222, 128, 0.7);
    }

    .worlds-panel h2 {
      margin: 0;
      font-size: var(--font-label);
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: #a5b4fc;
      font-weight: 800;
      position: relative;
      z-index: 1;
    }

    .world-grid {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .world-btn {
      width: 100%;
      border-radius: var(--card-radius);
      border: clamp(1px, 0.15vw, 2px) solid var(--border);
      padding: var(--spacing-md) var(--spacing-md);
      background: radial-gradient(circle at left, #020617 0, #020617 60%, #020617 100%);
      font-size: var(--font-world-btn);
      color: var(--text);
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
      cursor: pointer;
      text-align: left;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .world-btn::before {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at left, rgba(34, 197, 94, 0.1), transparent);
      opacity: 0;
      transition: var(--transition);
      pointer-events: none;
    }

    .world-btn:hover {
      transform: translateY(-3px) scale(1.02);
      border-color: rgba(148, 163, 184, 0.9);
      box-shadow: 0 10px 30px rgba(74, 222, 128, 0.3);
    }

    .world-btn:hover::before {
      opacity: 1;
    }

    .world-btn.active {
      border-color: var(--accent-strong);
      box-shadow: 0 0 30px rgba(34, 197, 94, 0.6);
      background: radial-gradient(circle at left, rgba(34, 197, 94, 0.25), #020617);
      transform: scale(1.05);
    }

    .world-name-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
    }

    .world-name {
      font-weight: 600;
    }

    .world-tagline {
      font-size: var(--font-small);
      color: var(--muted);
      font-weight: 500;
    }

    .world-status {
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      color: var(--muted);
    }

    .world-status.completed {
      color: #bbf7d0;
      border-color: var(--accent-strong);
      background: rgba(34, 197, 94, 0.16);
    }

    .world-status.current {
      color: #e0f2fe;
      border-color: #38bdf8;
      background: rgba(56, 189, 248, 0.15);
    }

    .world-main {
      border-radius: var(--card-radius);
      background: radial-gradient(circle at top, rgba(37, 99, 235, 0.18), #020617 55%, #020617);
      border: 2px solid rgba(148, 163, 184, 0.5);
      box-shadow: var(--shadow-soft);
      padding: 18px 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      height: calc(100vh - 180px);
      position: relative;
      overflow-y: auto;
      overflow-x: hidden;
    }

    .world-main::-webkit-scrollbar {
      width: 8px;
    }

    .world-main::-webkit-scrollbar-track {
      background: rgba(15, 23, 42, 0.5);
      border-radius: 4px;
    }

    .world-main::-webkit-scrollbar-thumb {
      background: rgba(74, 222, 128, 0.5);
      border-radius: 4px;
    }

    .world-main::-webkit-scrollbar-thumb:hover {
      background: rgba(74, 222, 128, 0.7);
    }

    .world-main::before {
      content: "";
      position: fixed;
      inset: -40%;
      background:
        radial-gradient(circle at 15% 0, rgba(244, 114, 182, 0.14), transparent 55%),
        radial-gradient(circle at 85% 0, rgba(56, 189, 248, 0.2), transparent 55%);
      opacity: 0.4;
      pointer-events: none;
      z-index: 0;
    }

    .world-main > * {
      position: relative;
      z-index: 1;
    }

    .world-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 10px;
    }

    .world-header-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .world-header h2 {
      margin: 0;
      font-size: clamp(24px, 2vw, 40px);
      font-weight: 800;
      background: linear-gradient(90deg, #60a5fa, #a78bfa);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .world-caption {
      font-size: var(--font-label);
      color: var(--muted);
      font-weight: 500;
    }

    .world-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      justify-content: flex-end;
    }

    .badge {
      font-size: var(--font-small);
      padding: var(--spacing-xs) var(--spacing-md);
      border-radius: 999px;
      border: clamp(1px, 0.15vw, 2px) solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.9);
      color: var(--muted);
      font-weight: 700;
    }

    .badge.accent {
      border-color: var(--accent-strong);
      color: #bbf7d0;
      background: var(--accent-soft);
    }

    .content-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 0;
    }

    .card {
      border-radius: var(--card-radius);
      border: clamp(1px, 0.15vw, 2px) solid rgba(148, 163, 184, 0.5);
      background: rgba(15, 23, 42, 0.96);
      padding: var(--spacing-lg) var(--spacing-xl);
      display: flex;
      flex-direction: column;
      gap: var(--spacing-md);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
      animation: none;
    }
    
    .card.initial-load {
      animation: slide-up 0.5s ease;
    }

    .card-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
    }

    .card-title {
      font-size: var(--font-card-title);
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: #a5b4fc;
      font-weight: 800;
    }

    .card-sub {
      font-size: var(--font-label);
      color: var(--muted);
      font-weight: 500;
    }

    .question-area {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 4px;
      flex: 1;
    }

    .question-text {
      font-size: var(--font-question);
      line-height: 1.5;
      font-weight: 600;
      color: #e0e7ff;
      min-height: clamp(50px, 4vh, 80px);
      max-height: clamp(80px, 8vh, 120px);
      overflow-y: auto;
      display: flex;
      align-items: center;
    }

    .help-text {
      font-size: var(--font-small);
      color: var(--muted);
      font-weight: 500;
    }

    .options-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .options-list .option-btn {
      animation: none;
    }
    
    .options-list.initial-load .option-btn {
      animation: slide-up 0.4s ease;
      animation-fill-mode: both;
    }

    .options-list.initial-load .option-btn:nth-child(1) { animation-delay: 0.1s; }
    .options-list.initial-load .option-btn:nth-child(2) { animation-delay: 0.2s; }
    .options-list.initial-load .option-btn:nth-child(3) { animation-delay: 0.3s; }
    .options-list.initial-load .option-btn:nth-child(4) { animation-delay: 0.4s; }

    .option-btn {
      border-radius: var(--card-radius);
      padding: var(--spacing-md) var(--spacing-lg);
      border: clamp(2px, 0.2vw, 3px) solid rgba(30, 64, 175, 0.8);
      background: rgba(15, 23, 42, 0.96);
      color: var(--text);
      font-size: var(--font-option);
      text-align: left;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: var(--spacing-sm);
      font-weight: 600;
      min-height: clamp(60px, 5vh, 90px);
    }
    
    .option-btn > div {
      flex: 1;
      line-height: 1.4;
    }

    .option-btn:hover {
      border-color: var(--accent-strong);
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 10px 40px rgba(74, 222, 128, 0.4);
      background: rgba(34, 197, 94, 0.1);
    }

    .option-label {
      font-size: var(--font-label);
      color: var(--muted);
      margin-right: var(--spacing-xs);
      font-weight: 700;
    }

    .pill-small {
      border-radius: 999px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      font-size: var(--font-small);
      padding: var(--spacing-xs) var(--spacing-sm);
      color: var(--muted);
      font-weight: 600;
    }

    .state-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: var(--font-small);
      color: var(--muted);
      gap: var(--spacing-xs);
      margin-top: auto;
      font-weight: 600;
    }

    .state-left,
    .state-right {
      display: flex;
      gap: 6px;
      align-items: center;
      flex-wrap: wrap;
    }

    .timer {
      font-variant-numeric: tabular-nums;
    }

    .locks-row {
      display: flex;
      gap: 6px;
    }

    .lock-pill {
      width: 16px;
      height: 16px;
      border-radius: 5px;
      border: 1px solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.96);
      position: relative;
      overflow: hidden;
    }

    .lock-pill.completed {
      border-color: var(--accent-strong);
      background: var(--accent-soft);
    }

    .lock-pill.completed::after {
      content: "";
      position: absolute;
      inset: 2px;
      border-radius: 3px;
      background: linear-gradient(135deg, var(--accent-strong), #a855f7);
    }

    .lock-pill.current {
      border-style: dashed;
      border-color: #38bdf8;
    }

    .feedback {
      font-size: var(--font-option);
      margin-top: var(--spacing-xs);
      font-weight: 700;
      padding: var(--spacing-md) var(--spacing-lg);
      border-radius: var(--card-radius);
      animation: bounce 0.6s ease;
    }

    .feedback.positive {
      color: #bbf7d0;
      background: rgba(34, 197, 94, 0.15);
      border: clamp(1px, 0.15vw, 2px) solid rgba(34, 197, 94, 0.5);
    }

    .feedback.negative {
      color: #fecaca;
      background: rgba(239, 68, 68, 0.15);
      border: clamp(1px, 0.15vw, 2px) solid rgba(239, 68, 68, 0.5);
    }

    .primary-btn,
    .secondary-btn,
    .ghost-btn {
      border-radius: 999px;
      font-size: var(--font-label);
      padding: var(--spacing-md) var(--spacing-xl);
      border: clamp(1px, 0.15vw, 2px) solid rgba(148, 163, 184, 0.7);
      background: rgba(15, 23, 42, 0.96);
      color: var(--text);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: var(--spacing-sm);
      transition: all 0.3s ease;
      font-weight: 700;
    }

    .primary-btn {
      border-color: var(--accent-strong);
      background: linear-gradient(90deg, #22c55e, #22c55e, #16a34a);
      color: #022c22;
      font-weight: 800;
      box-shadow: 0 12px 30px rgba(22, 163, 74, 0.5);
    }

    .primary-btn:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 20px 50px rgba(22, 163, 74, 0.7);
    }

    .secondary-btn:hover,
    .ghost-btn:hover {
      transform: translateY(-1px);
      border-color: var(--accent-strong);
    }

    .ghost-btn {
      background: transparent;
    }

    textarea {
      width: 100%;
      min-height: 70px;
      border-radius: 10px;
      border: 1px solid rgba(148, 163, 184, 0.6);
      background: rgba(15, 23, 42, 0.95);
      color: var(--text);
      font-size: 13px;
      padding: 6px 8px;
      resize: vertical;
      outline: none;
    }

    textarea:focus {
      border-color: var(--accent-strong);
      box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.4);
    }

    .mini-visual {
      font-size: 11px;
      color: var(--muted);
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .chip-row {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
    }

    .chip {
      border-radius: 999px;
      border: 1px dashed rgba(148, 163, 184, 0.5);
      padding: 2px 6px;
      font-size: 10px;
      color: var(--muted);
    }

    .hash-row {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 11px;
      background: rgba(15, 23, 42, 0.96);
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px dashed rgba(148, 163, 184, 0.6);
      overflow-x: auto;
      white-space: nowrap;
    }

    .flex-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
    }

    .hint {
      font-size: 11px;
      color: #e5e7eb;
    }

    .hint span {
      color: var(--accent-strong);
    }

    .divider {
      height: 1px;
      background: radial-gradient(circle, rgba(148, 163, 184, 0.4), transparent);
      margin: 4px -6px;
    }

    .small-label {
      font-size: var(--font-small);
      color: var(--muted);
      font-weight: 600;
    }

    /* WIN MODAL â€“ 3 WORLDS CLEARED */
    .win-modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease-out;
      z-index: 999;
    }

    .win-modal.active {
      opacity: 1;
      pointer-events: auto;
    }

    .win-modal-backdrop {
      position: absolute;
      inset: 0;
      background: rgba(15, 23, 42, 0.88);
      backdrop-filter: blur(12px);
    }

    .win-modal-content {
      position: relative;
      border-radius: 22px;
      border: 3px solid rgba(74, 222, 128, 0.9);
      background: radial-gradient(circle at top, rgba(74, 222, 128, 0.25), #020617);
      padding: 32px 28px 24px;
      box-shadow: 0 24px 60px rgba(22, 163, 74, 0.8), 0 0 100px rgba(74, 222, 128, 0.5);
      max-width: 500px;
      width: 90%;
      text-align: center;
      animation: pop-in 0.4s ease-out;
    }

    .win-title {
      font-size: 48px;
      font-weight: 900;
      margin-bottom: 12px;
      background: linear-gradient(90deg, #fbbf24, #f59e0b, #fbbf24);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      animation: gradient-shift 3s ease infinite;
    }

    .win-body {
      font-size: 24px;
      color: var(--muted);
      margin-bottom: 24px;
      font-weight: 600;
    }

    .win-confetti {
      position: absolute;
      inset: -40px;
      pointer-events: none;
      background:
        radial-gradient(circle at 10% 20%, rgba(239, 68, 68, 0.24), transparent 55%),
        radial-gradient(circle at 80% 10%, rgba(59, 130, 246, 0.3), transparent 55%),
        radial-gradient(circle at 20% 90%, rgba(234, 179, 8, 0.26), transparent 55%);
      opacity: 0.6;
      mix-blend-mode: screen;
    }

    @keyframes pop-in {
      0% {
        transform: translateY(10px) scale(0.96);
        opacity: 0;
      }
      100% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
    }

    /* SCORE POPUP NOTIFICATION */
    .score-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      z-index: 1000;
      padding: 24px 32px;
      border-radius: 20px;
      font-size: clamp(24px, 2vw, 36px);
      font-weight: 800;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
      pointer-events: none;
      opacity: 0;
      transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    .score-popup.show {
      transform: translate(-50%, -50%) scale(1);
      opacity: 1;
    }

    .score-popup.positive {
      background: linear-gradient(135deg, rgba(34, 197, 94, 0.95), rgba(22, 163, 74, 0.95));
      color: #fff;
      border: 3px solid #bbf7d0;
    }

    .score-popup.negative {
      background: linear-gradient(135deg, rgba(239, 68, 68, 0.95), rgba(220, 38, 38, 0.95));
      color: #fff;
      border: 3px solid #fecaca;
    }

    .score-popup-value {
      display: block;
      font-size: clamp(32px, 3vw, 48px);
      margin-top: 8px;
    }

    .option-btn.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }
  </style>
</head>
<body>
<div class="app-shell">
  <header>
    <div class="title-block">
      <h1>Agent Zero: Digital Recovery Suite</h1>
      <div class="title-sub">Master AI, ML, and Data Engineering Challenges</div>
      <div class="pill-row">
        <div class="pill">
          <span class="dot"></span>
          Live session Â· <span id="world-counter-label">World 1 of 8</span>
        </div>
        <div class="pill">
          Mode: <strong>Solo</strong> Â· Difficulty: Adaptive
        </div>
      </div>
    </div>
    <div class="meta">
      <div class="score-chip">
        SCORE: <strong id="score-display">0</strong>
        <span style="width:1px;height:14px;background:#1f2937;"></span>
        Cleared: <span id="cleared-worlds-count">0</span>/3 to win
      </div>
      <div class="progress-bar-shell">
        <div id="progress-bar-inner" class="progress-bar-inner"></div>
      </div>
    </div>
  </header>

  <main>
    <!-- LEFT: WORLD SELECTOR -->
    <aside class="worlds-panel">
      <h2>World Map</h2>
      <div class="world-grid" id="world-grid">
        <!-- buttons are created by JS to keep state synced -->
      </div>
    </aside>

    <!-- RIGHT: ACTIVE WORLD CONTENT -->
    <section class="world-main">
      <div class="world-header">
        <div class="world-header-left">
          <h2 id="world-title">AI Escape Room</h2>
          <div id="world-caption" class="world-caption">
            Unlock corrupted doors by answering core AI questions under time pressure.
          </div>
        </div>
        <div class="world-badges">
          <span class="badge accent" id="world-badge-primary">AI Fundamentals</span>
          <span class="badge" id="world-badge-secondary">Timed Â· Scenario-based</span>
        </div>
      </div>

      <div class="content-grid" id="world-content">
        <!-- Each world injects its own markup -->
      </div>
    </section>
  </main>
</div>

<!-- SCORE POPUP NOTIFICATION -->
<div id="score-popup" class="score-popup">
  <div id="score-popup-text"></div>
  <span id="score-popup-value" class="score-popup-value"></span>
</div>

<!-- WIN MODAL â€“ FIRES AFTER ANY 3 WORLDS CLEARED -->
<div id="win-modal" class="win-modal">
  <div class="win-modal-backdrop"></div>
  <div class="win-modal-content">
    <div class="win-confetti"></div>
    <div class="win-title">ðŸŽ‰ Mission Accomplished!</div>
    <div class="win-body">
      Youâ€™ve successfully cleared 3 rooms.<br/>
      Final Score: <span id="final-score-display">0</span><br/>
      The system will reset with fresh questions for the next player.
    </div>
    <button id="win-reset-btn" class="primary-btn">Start New Session</button>
  </div>
</div>

<script>
    /****************************************************
   * EMBEDDED CSV DATA - Questions loaded from here
   * This allows the game to work without a server
   ****************************************************/
  const EMBEDDED_CSV_DATA = "World,Question_Number,Question,Option_A,Option_B,Option_C,Option_D,Correct_Answer,Difficulty\nAI Escape Room,1,What is a transformer in modern AI?,A hardware chip used exclusively in robotics.,A model that only works for images using convolution layers.,A neural architecture using self-attention to process sequences in parallel.,A simple rule-based system for if/else logic.,C,easy\nAI Escape Room,2,What is Retrieval-Augmented Generation (RAG)?,Combining an LLM with external retrieval of documents for better answers.,Training a model only once and freezing it.,Using generative models to compress images.,A cryptographic protocol for secure hashing.,A,easy\nAI Escape Room,3,What is an AI hallucination?,When a model refuses to answer.,GPU overclocking issue.,Noise in sensor data.,Model producing confident but factually wrong or fabricated outputs.,D,hard\nAI Escape Room,4,What is multimodal AI?,AI that only works for text data.,\"AI that can consume and reason over multiple input types (text, image, audio, video).\",AI that runs on multiple GPUs.,AI that can speak multiple human languages only.,B,hard\nAI Escape Room,5,What is fine-tuning in machine learning?,Removing outliers from data.,Training a pre-trained model on a specific task or dataset.,Adjusting hyperparameters before training.,Compressing a model to reduce size.,B,easy\nAI Escape Room,6,What is the purpose of attention mechanisms in neural networks?,To prevent overfitting.,To reduce model size.,To allow models to focus on relevant parts of input data.,To speed up training time.,C,easy\nAI Escape Room,7,What is zero-shot learning?,Training a model with zero data points.,Setting all weights to zero.,A model performing tasks it wasn't explicitly trained on.,Training without a validation set.,C,hard\nAI Escape Room,8,What is the difference between supervised and unsupervised learning?,\"Supervised uses labeled data, unsupervised finds patterns in unlabeled data.\",Unsupervised requires more compute power.,There is no difference.,Supervised is faster than unsupervised.,A,easy\nAI Escape Room,9,What is a neural network activation function?,A function that introduces non-linearity to help learn complex patterns.,A function that loads training data.,A function that starts the training process.,A function that saves model weights.,A,easy\nAI Escape Room,10,What is transfer learning?,Converting models between frameworks.,Moving data between servers.,Using knowledge from one task to improve performance on another task.,Transferring model ownership.,C,easy\nAI Escape Room,11,What is the vanishing gradient problem?,When the learning rate is too high.,\"When gradients become too small during backpropagation, hindering learning.\",When training data disappears.,When the model runs out of memory.,B,hard\nAI Escape Room,12,What is batch normalization?,Removing bad data samples.,Grouping similar data together.,A technique to normalize layer inputs to stabilize and speed up training.,Processing data in batches.,C,hard\nAI Escape Room,13,What is the purpose of dropout in neural networks?,To speed up inference.,To reduce model size.,To remove bad training examples.,To randomly disable neurons during training to prevent overfitting.,D,easy\nAI Escape Room,14,What is an embedding in NLP?,A way to compress text files.,A type of neural network architecture.,A dense vector representation of words or tokens in continuous space.,A data preprocessing technique.,C,easy\nAI Escape Room,15,What is the difference between precision and recall?,\"Precision is for classification, recall is for regression.\",\"Precision measures speed, recall measures accuracy.\",Precision is true positives / predicted positives; Recall is true positives / actual positives.,They are the same metric.,C,hard\nAI Escape Room,16,What is a convolutional neural network (CNN) primarily used for?,Image processing and computer vision tasks.,Time series prediction.,Audio synthesis.,Text generation.,A,easy\nAI Escape Room,17,What is reinforcement learning?,Training with extra labeled data.,Repeating training multiple times.,Learning through trial and error with rewards and penalties.,Using multiple models together.,C,easy\nAI Escape Room,18,What is the purpose of a loss function?,To measure how well the model's predictions match the actual values.,To compress the model.,To delete bad data.,To visualize training progress.,A,easy\nAI Escape Room,19,What is gradient descent?,A way to clean data.,A method to reduce model size.,An optimization algorithm to minimize the loss function by updating weights.,A neural network architecture.,C,easy\nAI Escape Room,20,What is overfitting?,When training takes too long.,When the model uses too much memory.,When a model is too large.,When a model learns training data too well and performs poorly on new data.,D,easy\nAI Escape Room,21,What is a recurrent neural network (RNN) good for?,Image classification.,Static tabular data.,Sequential data like text or time series.,Clustering tasks.,C,easy\nAI Escape Room,22,What is the purpose of a validation set?,To train the model.,To store backup data.,To test the final model.,To tune hyperparameters and evaluate model performance during training.,D,easy\nAI Escape Room,23,What is ensemble learning?,Training on multiple datasets.,Using multiple GPUs.,Training one large model.,Combining multiple models to improve overall performance.,D,hard\nAI Escape Room,24,What is the bias-variance tradeoff?,Choosing between fast and slow training.,Balancing model simplicity (bias) and complexity (variance) for best generalization.,Deciding between CPU and GPU.,Choosing between supervised and unsupervised learning.,B,hard\nAI Escape Room,25,What is a GAN (Generative Adversarial Network)?,A type of supervised learning.,Two networks (generator and discriminator) competing to create realistic data.,A data cleaning algorithm.,A network for data compression.,B,hard\nAI Escape Room,26,What is tokenization in NLP?,Removing punctuation.,Translating text.,Encrypting text data.,Breaking text into smaller units like words or subwords.,D,easy\nAI Escape Room,27,What is the purpose of a learning rate?,To control how fast data is loaded.,To set the number of epochs.,To measure model accuracy.,To control the size of weight updates during training.,D,easy\nAI Escape Room,28,What is cross-validation?,Validating data quality.,Training on multiple datasets.,A technique to assess model performance by splitting data into multiple folds.,Comparing different models.,C,hard\nAI Escape Room,29,What is feature engineering?,Removing features from data.,Creating or transforming input features to improve model performance.,Visualizing features.,Building new hardware.,B,easy\nAI Escape Room,30,What is the softmax function used for?,To reduce model size.,To normalize input data.,To convert raw scores into probabilities for multi-class classification.,To speed up training.,C,hard\nAI Escape Room,31,What is data augmentation?,Creating modified versions of training data to increase dataset size and diversity.,Adding more servers.,Compressing data.,Removing duplicate data.,A,easy\nAI Escape Room,32,What is the purpose of pooling layers in CNNs?,To increase image resolution.,To colorize images.,To add more layers.,To reduce spatial dimensions and computational cost while retaining important features.,D,hard\nAI Escape Room,33,What is early stopping?,Starting training early.,Ending training manually.,Reducing the number of epochs.,Stopping training when validation performance stops improving to prevent overfitting.,D,easy\nAI Escape Room,34,What is a hyperparameter?,A parameter learned during training.,A type of neural network.,A configuration setting set before training (like learning rate or batch size).,A data preprocessing step.,C,easy\nAI Escape Room,35,What is the F1 score?,The harmonic mean of precision and recall.,The first layer's output.,The number of features.,The training speed metric.,A,hard\nAI Escape Room,36,What is backpropagation?,Reversing predictions.,Undoing training.,An algorithm to calculate gradients and update weights by propagating errors backward.,Moving data backwards.,C,hard\nAI Escape Room,37,What is a confusion matrix?,\"A table showing true positives, false positives, true negatives, and false negatives.\",A matrix that confuses the model.,A data visualization tool.,A type of neural network layer.,A,easy\nAI Escape Room,38,What is the purpose of regularization?,To increase model size.,To make training faster.,To prevent overfitting by adding penalties to the loss function.,To clean data.,C,easy\nAI Escape Room,39,What is a pre-trained model?,A model that failed training.,A model already trained on a large dataset that can be fine-tuned for specific tasks.,A model without weights.,A model that trains itself.,B,easy\nAI Escape Room,40,\"What is the difference between AI, ML, and Deep Learning?\",\"AI is the broadest concept, ML is a subset of AI, and Deep Learning is a subset of ML.\",\"Deep Learning came first, then ML, then AI.\",AI is only for robots.,They are all the same thing.,A,easy\nAI Escape Room,41,What is model inference?,Training a model.,Using a trained model to make predictions on new data.,Saving model weights.,Evaluating model accuracy.,B,easy\nAI Escape Room,42,What is the purpose of batch size in training?,To control the learning rate.,To set the number of layers.,To determine how many samples are processed before updating weights.,To set the model size.,C,easy\nAI Escape Room,43,What is a latent space?,A compressed representation of data in lower dimensions.,The final output layer.,A type of activation function.,Empty space in memory.,A,hard\nAI Escape Room,44,What is the purpose of normalization in data preprocessing?,To remove data.,To visualize data.,To scale features to a similar range for better model performance.,To add more features.,C,easy\nAI Escape Room,45,What is a decision tree?,A tree-like model that makes decisions based on feature values through branching.,A data structure for storage.,A neural network architecture.,A visualization tool.,A,easy\nAI Escape Room,46,What is the curse of dimensionality?,Having too many dimensions in your office.,When training is too fast.,When models are too small.,\"As feature dimensions increase, data becomes sparse and models need exponentially more data.\",D,hard\nAI Escape Room,47,What is a random forest?,A single decision tree.,A data cleaning technique.,A forest with random trees.,An ensemble of decision trees that vote on predictions.,D,easy\nAI Escape Room,48,What is the purpose of an optimizer in training?,To update model weights efficiently to minimize the loss function.,To speed up data loading.,To compress the model.,To optimize data storage.,A,easy\nAI Escape Room,49,What is prompt engineering?,Crafting effective input prompts to get better outputs from language models.,Building hardware for AI.,Engineering training data.,Optimizing model architecture.,A,easy\nAI Escape Room,50,What is the difference between classification and regression?,They are the same.,\"Classification predicts categories, regression predicts continuous values.\",Regression only works with images.,Classification is faster.,B,easy\nML Model Builder,1,Your training dataset has 15% missing values in a numeric column. What's a reasonable first approach?,Randomly fill values from another column.,Replace missing values with zero blindly.,Impute with median or mean based on distribution.,Drop all rows with any missing value.,C,easy\nML Model Builder,2,You're predicting churn (yes/no) on a tabular dataset with mixed numeric and categorical features. Baseline model?,K-Means Clustering,PCA,Linear Regression,Random Forest / Gradient Boosted Trees,D,easy\nML Model Builder,3,Train accuracy is 0.99 but validation accuracy is 0.68. What's the most direct mitigation?,Increase model complexity further.,Remove validation split.,Train for many more epochs.,Add regularization / early stopping / dropout.,D,hard\nML Model Builder,4,You have 500 features but only 1000 samples. What's the risk?,High risk of overfitting due to curse of dimensionality.,Features don't matter for model performance.,No risk; more features are always better.,The model will train faster.,A,hard\nML Model Builder,5,Your model performs well on training but poorly on test data. What's happening?,The model is underfitting.,The data is corrupted.,The model is perfect.,The model is overfitting.,D,easy\nML Model Builder,6,Which metric is best for imbalanced classification (99% negative class)?,Accuracy,F1 Score or AUC-ROC,Mean Squared Error,R-squared,B,hard\nML Model Builder,7,What's the purpose of a train-test split?,To train faster.,To evaluate model performance on unseen data.,To clean data.,To reduce dataset size.,B,easy\nML Model Builder,8,Your categorical feature has 1000 unique values. What's a good encoding strategy?,Convert to numeric arbitrarily.,Ignore the feature.,Use target encoding or embeddings.,One-hot encode all values.,C,hard\nML Model Builder,9,Learning rate is too high. What symptom do you see?,Model accuracy is perfect.,No symptoms.,Training is too slow.,Training loss oscillates or diverges.,D,easy\nML Model Builder,10,What's the benefit of using cross-validation?,Larger models.,Better visualizations.,Faster training.,More robust performance estimates by testing on multiple data splits.,D,easy\nML Model Builder,11,Your model has high bias. What should you do?,Increase model complexity.,Decrease model complexity.,Remove features.,Add more training data.,A,easy\nML Model Builder,12,What's the purpose of a confusion matrix?,To show feature importance.,To confuse the model.,To plot training loss.,To visualize classification performance (TP/FP/TN/FN).,D,easy\nML Model Builder,13,You want to predict house prices. Which algorithm type?,Regression,Classification,Dimensionality reduction,Clustering,A,easy\nML Model Builder,14,What's the purpose of feature scaling?,To make features look better.,To add features.,To ensure features contribute equally to distance-based algorithms.,To remove features.,C,easy\nML Model Builder,15,Your gradient boosting model is overfitting. What helps?,Remove all features.,Increase number of trees.,Train longer.,Reduce tree depth or add regularization.,D,hard\nML Model Builder,16,What's the difference between bagging and boosting?,Bagging is faster.,Boosting uses less memory.,Bagging trains models in parallel; boosting trains sequentially focusing on errors.,No difference.,C,hard\nML Model Builder,17,What's a good first step in any ML pipeline?,Explore and understand the data (EDA).,Train immediately.,Delete outliers.,Deploy the model.,A,easy\nML Model Builder,18,Your model predicts probabilities. How do you convert to binary predictions?,Random selection.,Always predict 1.,Use a threshold (typically 0.5).,Always predict 0.,C,easy\nML Model Builder,19,What's the purpose of a validation set?,To train the model.,To clean data.,To store extra data.,To tune hyperparameters without touching test data.,D,easy\nML Model Builder,20,Your time series model is leaking future information. What's the issue?,The model is too good.,No issue.,Data leakage - using future data to predict past.,The data is sorted.,C,hard\nML Model Builder,21,What's the purpose of L1 regularization?,To increase model size.,To remove data.,To add penalty on absolute weights; can lead to sparse models.,To make training faster.,C,hard\nML Model Builder,22,What's the purpose of L2 regularization?,To add penalty on squared weights; prevents large weights.,To add more layers.,To speed up training.,To delete features.,A,hard\nML Model Builder,23,Your neural network isn't learning (loss stays flat). What could help?,Check learning rate; try different initialization; check data.,Decrease learning rate further.,Train longer only.,Add more layers.,A,hard\nML Model Builder,24,What's the purpose of batch gradient descent?,To process data in batches for efficiency.,To process all data at once before updating weights.,To visualize data.,To remove batches.,A,easy\nML Model Builder,25,What's stochastic gradient descent (SGD)?,Updating weights after each single sample.,Processing all data at once.,Random training.,Never updating weights.,A,easy\nML Model Builder,26,Your model has high variance. What should you do?,Add more features.,Add more training data or reduce model complexity.,Train longer.,Remove all data.,B,easy\nML Model Builder,27,What's the purpose of early stopping?,To never stop training.,To stop when validation performance stops improving.,To start training early.,To stop training early randomly.,B,easy\nML Model Builder,28,What's a good way to handle outliers?,Always delete them.,Ignore them.,Analyze context; consider capping/transformation or robust algorithms.,Set to zero.,C,easy\nML Model Builder,29,Your model training is very slow. What could help?,Add more layers.,Use smaller batch size; use GPU; reduce model complexity.,Train longer.,Add more features.,B,easy\nML Model Builder,30,What's the purpose of data augmentation?,To artificially increase training data through transformations.,To visualize data.,To delete data.,To compress data.,A,easy\nML Model Builder,31,What's transfer learning in deep learning?,Transferring ownership.,Converting frameworks.,Using pre-trained model weights as starting point for new task.,Moving data between servers.,C,easy\nML Model Builder,32,Your classification model always predicts the majority class. What's wrong?,Too simple.,Too complex.,Perfect model.,Model hasn't learned; check learning rate/data/loss function.,D,easy\nML Model Builder,33,What's the purpose of dropout?,To randomly drop neurons during training to prevent overfitting.,To remove data.,To reduce model size.,To speed up inference.,A,easy\nML Model Builder,34,What's the purpose of batch normalization?,To visualize batches.,To remove batches.,To normalize layer inputs for stable and faster training.,To process batches.,C,easy\nML Model Builder,35,Your model performs well on validation but poorly on test. What happened?,Possible data leakage or validation set not representative.,Model is too simple.,Perfect model.,Model is too complex.,A,hard\nML Model Builder,36,What's the purpose of learning rate scheduling?,To schedule meetings.,To schedule model saving.,To schedule data loading.,To adjust learning rate during training for better convergence.,D,hard\nML Model Builder,37,What's the purpose of momentum in optimization?,To accelerate convergence by accumulating past gradients.,To stop training.,To remove gradients.,To make training slower.,A,hard\nML Model Builder,38,Your model has many correlated features. What could help?,Add more features.,Use PCA or feature selection to reduce redundancy.,Ignore correlation.,Keep all features.,B,hard\nML Model Builder,39,What's the purpose of grid search?,To search for data.,To search for models.,To systematically search hyperparameter combinations.,To search for bugs.,C,easy\nML Model Builder,40,What's the purpose of random search?,To randomly sample hyperparameter combinations (often more efficient).,To search for data.,To search randomly.,To randomize training.,A,easy\nML Model Builder,41,Your model predictions are biased toward one class. What could help?,Ignore it.,Train longer.,Remove the class.,Adjust class weights or use resampling techniques.,D,hard\nML Model Builder,42,What's the purpose of feature importance?,To make features important.,To identify which features contribute most to predictions.,To remove features.,To add features.,B,easy\nML Model Builder,43,Your model is too slow for production. What could help?,Add more features.,Model compression/quantization or use simpler model.,Train longer.,Add more layers.,B,easy\nML Model Builder,44,What's the purpose of A/B testing in ML?,To test data.,To compare model performance in production with control.,To test alphabets.,To test hardware.,B,easy\nML Model Builder,45,Your model drifts over time in production. What's happening?,Model is perfect.,Model is too simple.,Model is too complex.,Data distribution is changing; model needs retraining.,D,hard\nML Model Builder,46,What's the purpose of model versioning?,To count versions.,To track and manage different model iterations.,To compress models.,To delete models.,B,easy\nML Model Builder,47,Your model has data leakage. What does this mean?,Data is leaking from servers.,Training data contains information from test data or future.,Data is corrupted.,Data is missing.,B,hard\nML Model Builder,48,What's the purpose of feature crosses?,To visualize features.,To cross out features.,To create interaction features by combining existing features.,To delete features.,C,hard\nML Model Builder,49,Your model needs to explain predictions. Which approach?,Use any model.,Use interpretable models (linear/tree) or SHAP/LIME.,Use more complex models.,Ignore explanations.,B,hard\nML Model Builder,50,What's the purpose of ensemble methods?,To combine multiple models for better performance.,To use one model.,To compress models.,To delete models.,A,easy\nGenAI Prompt Arena,1,Original: 'Write code.' What is the better prompt for a production-ready function?,Write any JavaScript code you want.,Write a Python function named `add` that takes two integers and returns their sum. Include type hints and one usage example.,Explain life in code form.,Code please.,B,easy\nGenAI Prompt Arena,2,Which instruction is best to reduce hallucination when asking about niche APIs?,Ignore unspecified details.,\"If you are not certain, say you are unsure and indicate what documentation I should check.\",Always respond with code only.,If you don't know; invent an answer.,B,hard\nGenAI Prompt Arena,3,Which prompt is more token-efficient while maintaining clarity?,Describe this:,\"Please write a very detailed, comprehensive, and extremely thorough explanation...\",Tell me everything you know about this topic in great detail...,Explain in 3 sentences:,D,easy\nGenAI Prompt Arena,4,You want consistent JSON output. What should you include in the prompt?,Hope for the best.,Nothing specific.,Specify exact JSON structure with example.,Just ask for JSON.,C,easy\nGenAI Prompt Arena,5,Which prompt technique helps with complex tasks?,Use shortest possible prompt.,Break task into step-by-step instructions (chain-of-thought).,Give one vague instruction.,Never give examples.,B,easy\nGenAI Prompt Arena,6,How do you prevent the model from making up facts?,Instruct to only use provided context and admit uncertainty.,Encourage creativity.,Ask for detailed answers.,Use shorter prompts.,A,hard\nGenAI Prompt Arena,7,Which prompt is better for code generation?,Write code.,Write a Python function that validates email addresses using regex. Include error handling and 3 test cases.,Code something.,Make a function.,B,easy\nGenAI Prompt Arena,8,You want the model to act as an expert. What helps?,Provide role context: 'You are a senior data scientist...',No context needed.,Use simple prompts.,Avoid details.,A,easy\nGenAI Prompt Arena,9,How do you handle ambiguous prompts?,Make them shorter.,Add constraints and clarify expected output format.,Remove details.,Leave them ambiguous.,B,easy\nGenAI Prompt Arena,10,Which prompt technique improves reasoning?,Ask for immediate answer.,Use one word prompts.,Ask model to 'think step by step' before answering.,Avoid explanations.,C,hard\nGenAI Prompt Arena,11,You want creative but safe outputs. What helps?,Provide clear boundaries and content guidelines.,Shortest prompt.,No guidelines.,Maximum freedom.,A,easy\nGenAI Prompt Arena,12,How do you get consistent formatting?,Never specify format.,Hope for consistency.,Use vague instructions.,Provide explicit format template with examples.,D,easy\nGenAI Prompt Arena,13,Which prompt is better for summarization?,Condense.,Summarize this.,\"Summarize this article in 3 bullet points, focusing on key findings.\",Make it shorter.,C,easy\nGenAI Prompt Arena,14,You want factual accuracy. What helps?,Use creative prompts.,Request citations or references for claims.,Encourage imagination.,Avoid specifics.,B,hard\nGenAI Prompt Arena,15,How do you handle multi-step tasks?,Combine everything.,Number steps clearly and specify output for each step.,Shortest prompt.,One vague prompt.,B,easy\nGenAI Prompt Arena,16,Which prompt technique reduces bias?,Use shortest prompt.,Ignore bias.,Avoid mentioning bias.,Explicitly request balanced perspectives and diverse viewpoints.,D,hard\nGenAI Prompt Arena,17,You want specific tone. What helps?,Specify desired tone: 'professional' or 'casual' or 'technical'.,Don't mention tone.,Hope for best.,Use emojis.,A,easy\nGenAI Prompt Arena,18,How do you improve prompt clarity?,Make it shorter.,Use precise language and define key terms.,Add more ambiguity.,Remove context.,B,easy\nGenAI Prompt Arena,19,Which prompt is better for analysis?,Check this.,\"Analyze this data for trends, outliers, and correlations. Provide 3 key insights.\",Look at this.,Analyze this.,B,easy\nGenAI Prompt Arena,20,You want structured output. What helps?,Shortest prompt.,No structure needed.,Vague instructions.,Provide clear structure template with headers/sections.,D,easy\nGenAI Prompt Arena,21,How do you handle edge cases?,Use simple prompts.,Explicitly mention edge cases to consider.,Ignore them.,Avoid complexity.,B,hard\nGenAI Prompt Arena,22,Which prompt technique improves accuracy?,Encourage guessing.,Remove details.,Provide relevant context and examples.,Use shortest prompt.,C,easy\nGenAI Prompt Arena,23,You want concise output. What helps?,Hope for brevity.,Specify word/sentence limit: 'in 50 words or less'.,Don't specify length.,Use long prompt.,B,easy\nGenAI Prompt Arena,24,How do you get better code quality?,Avoid details.,Just ask for code.,Specify requirements: error handling/comments/tests.,Shortest prompt.,C,easy\nGenAI Prompt Arena,25,Which prompt is better for comparison?,Look at both.,\"Compare A and B across these dimensions: cost, speed, accuracy. Use table format.\",Compare these.,Check differences.,B,easy\nGenAI Prompt Arena,26,You want actionable advice. What helps?,Avoid specifics.,Request specific actionable steps with priorities.,Ask vaguely.,Shortest prompt.,B,easy\nGenAI Prompt Arena,27,How do you handle technical topics?,Use simple language only.,Avoid jargon.,Specify technical level: 'explain for senior engineers'.,Shortest prompt.,C,easy\nGenAI Prompt Arena,28,Which prompt technique reduces errors?,Encourage speed.,Shortest prompt.,Avoid details.,Request verification and double-checking of facts.,D,hard\nGenAI Prompt Arena,29,You want examples in output. What helps?,Shortest prompt.,Hope for examples.,Explicitly request: 'provide 3 examples for each point'.,Don't ask for examples.,C,easy\nGenAI Prompt Arena,30,How do you improve prompt specificity?,Stay vague.,Add specific constraints and success criteria.,Remove context.,Make shorter.,B,easy\nGenAI Prompt Arena,31,Which prompt is better for debugging?,Fix this code.,Check this.,\"Debug this Python code. Identify the error, explain why it occurs, and provide corrected version.\",Make it work.,C,easy\nGenAI Prompt Arena,32,You want balanced perspective. What helps?,Take one side.,Avoid balance.,Request pros and cons or multiple viewpoints.,Shortest prompt.,C,easy\nGenAI Prompt Arena,33,How do you handle sensitive topics?,Ignore sensitivity.,Shortest prompt.,Provide ethical guidelines and request respectful approach.,Avoid guidelines.,C,hard\nGenAI Prompt Arena,34,Which prompt technique improves relevance?,Stay general.,Provide specific context and constraints.,Remove details.,Shortest prompt.,B,easy\nGenAI Prompt Arena,35,You want prioritized output. What helps?,No prioritization.,Hope for order.,Shortest prompt.,Request ranking or prioritization: 'list in order of importance'.,D,easy\nGenAI Prompt Arena,36,How do you get better explanations?,Just ask why.,Shortest prompt.,Avoid details.,Request: 'explain like I'm 5' or 'explain with analogies'.,D,easy\nGenAI Prompt Arena,37,Which prompt is better for translation?,Change language.,Convert to Spanish.,Translate this.,\"Translate this English text to Spanish, maintaining formal tone and technical accuracy.\",D,easy\nGenAI Prompt Arena,38,You want iterative refinement. What helps?,Start over each time.,Ignore context.,Build on previous responses with follow-up prompts.,One shot only.,C,easy\nGenAI Prompt Arena,39,How do you handle ambiguous requirements?,Guess intent.,Shortest prompt.,Ask clarifying questions or make assumptions explicit.,Leave ambiguous.,C,hard\nGenAI Prompt Arena,40,Which prompt technique improves completeness?,Stay brief.,Request comprehensive coverage: 'cover all aspects'.,Shortest prompt.,Avoid details.,B,easy\nGenAI Prompt Arena,41,You want specific format (markdown/JSON). What helps?,Explicitly state: 'respond in markdown format' or 'JSON only'.,Don't specify.,Hope for format.,Shortest prompt.,A,easy\nGenAI Prompt Arena,42,How do you reduce verbosity?,Add more details.,Specify: 'be concise' or 'maximum 100 words'.,Accept any length.,Longest prompt.,B,easy\nGenAI Prompt Arena,43,Which prompt is better for brainstorming?,Be creative.,Give suggestions.,Think of ideas.,\"Generate 10 creative ideas for X, considering Y constraints.\",D,easy\nGenAI Prompt Arena,44,You want evidence-based output. What helps?,Request: 'support claims with data or research'.,Accept opinions.,Shortest prompt.,Avoid evidence.,A,hard\nGenAI Prompt Arena,45,How do you improve prompt consistency?,Vary everything.,Change prompts randomly.,Use templates and consistent structure across similar tasks.,No patterns.,C,easy\nGenAI Prompt Arena,46,Which prompt technique reduces hallucination?,Encourage creativity.,Shortest prompt.,Ground in provided documents: 'only use information from attached text'.,Maximum freedom.,C,hard\nGenAI Prompt Arena,47,You want step-by-step guide. What helps?,Shortest prompt.,Avoid structure.,Request: 'provide step-by-step guide with numbered steps'.,Ask for guide.,C,easy\nGenAI Prompt Arena,48,How do you handle multiple outputs?,Request: 'provide 3 alternative approaches' or 'generate 5 variations'.,Ask once.,Single output only.,Shortest prompt.,A,easy\nGenAI Prompt Arena,49,Which prompt is better for evaluation?,Judge this.,\"Evaluate this solution against criteria: efficiency, readability, scalability. Rate each 1-10.\",Evaluate this.,Rate this.,B,easy\nGenAI Prompt Arena,50,You want model to show reasoning. What helps?,Request: 'show your work' or 'explain reasoning step-by-step'.,Shortest prompt.,Hide reasoning.,Just ask for answer.,A,hard\nBlockchain Hash Hunt,1,You see a block whose hash doesn't match the recomputed hash from its contents. What does that indicate?,Hashes are supposed to change randomly all the time.,The network is offline.,The consensus algorithm changed.,The block was tampered with or corrupted.,D,easy\nBlockchain Hash Hunt,2,Which consensus mechanism is energy-efficient and common in modern chains?,Proof of Work (PoW),Proof of Noise,Proof of Burn,Proof of Stake (PoS),D,hard\nBlockchain Hash Hunt,3,What happens if you change one character in a block's data?,Only that block is affected.,\"The hash changes completely, breaking the chain.\",The blockchain auto-repairs itself.,Nothing changes.,B,easy\nBlockchain Hash Hunt,4,What is a blockchain?,A distributed ledger of linked blocks containing transactions.,A type of cryptocurrency.,A mining algorithm.,A single database.,A,easy\nBlockchain Hash Hunt,5,What is the purpose of mining in Proof of Work?,To validate transactions and add blocks by solving cryptographic puzzles.,To speed up transactions.,To create new coins only.,To delete old blocks.,A,easy\nBlockchain Hash Hunt,6,What is a smart contract?,A mining algorithm.,A legal document.,Self-executing code on blockchain that runs when conditions are met.,A type of cryptocurrency.,C,easy\nBlockchain Hash Hunt,7,What is a 51% attack?,A type of consensus.,Controlling majority of network hash power to manipulate blockchain.,Owning 51% of coins.,A mining reward.,B,hard\nBlockchain Hash Hunt,8,What is the purpose of a nonce in mining?,To encrypt data.,To sign transactions.,A number miners change to find valid hash meeting difficulty target.,To store data.,C,hard\nBlockchain Hash Hunt,9,What is a merkle tree used for?,To mine blocks.,To create wallets.,To plant trees.,To efficiently verify transaction integrity in a block.,D,hard\nBlockchain Hash Hunt,10,What is the difference between public and private blockchain?,No difference.,Public is permissionless; private is permissioned with restricted access.,Public is faster.,Private is more secure always.,B,easy\nBlockchain Hash Hunt,11,What is a fork in blockchain?,A mining tool.,A wallet type.,A split in blockchain creating two separate chains.,A utensil.,C,easy\nBlockchain Hash Hunt,12,What is the purpose of block height?,To measure block size.,To measure physical height.,To indicate block's position in the chain (number of blocks before it).,To count transactions.,C,easy\nBlockchain Hash Hunt,13,What is gas in Ethereum?,A mining algorithm.,A type of coin.,Fuel for cars.,Fee required to execute transactions or smart contracts.,D,easy\nBlockchain Hash Hunt,14,What is immutability in blockchain?,Blocks are temporary.,Blocks can be easily changed.,Once added; blocks are extremely difficult to alter or delete.,Blocks change randomly.,C,easy\nBlockchain Hash Hunt,15,What is a genesis block?,The first block in a blockchain.,The last block.,A special mining block.,A deleted block.,A,easy\nBlockchain Hash Hunt,16,What is double-spending?,A mining technique.,Spending the same cryptocurrency twice by manipulating the network.,Spending twice as much.,A reward system.,B,hard\nBlockchain Hash Hunt,17,What is a wallet in cryptocurrency?,Software/hardware storing private keys to access cryptocurrency.,A mining device.,A physical wallet.,A blockchain node.,A,easy\nBlockchain Hash Hunt,18,What is the purpose of a private key?,To sign transactions and prove ownership of cryptocurrency.,To create blocks.,To unlock doors.,To mine blocks.,A,easy\nBlockchain Hash Hunt,19,What is the purpose of a public key?,To delete transactions.,To open locks.,To receive cryptocurrency (like an account number).,To mine blocks.,C,easy\nBlockchain Hash Hunt,20,What is a node in blockchain?,A knot.,A mining algorithm.,A computer participating in the blockchain network.,A wallet type.,C,easy\nBlockchain Hash Hunt,21,What is consensus in blockchain?,Agreement on rules.,A mining reward.,A transaction type.,Mechanism for network to agree on blockchain state.,D,easy\nBlockchain Hash Hunt,22,What is block time?,Time to transact.,Time to mine.,Average time between adding new blocks to chain.,Time to create a block.,C,easy\nBlockchain Hash Hunt,23,What is a transaction fee?,A mining reward.,Free transactions.,Fee paid to miners/validators for processing transactions.,A block reward.,C,easy\nBlockchain Hash Hunt,24,What is decentralization in blockchain?,No single point of control; distributed across network.,Cheaper transactions.,One central authority.,Faster processing.,A,easy\nBlockchain Hash Hunt,25,What is a hard fork?,A temporary split.,A physical fork.,A soft change.,Permanent divergence in blockchain; non-backward compatible.,D,hard\nBlockchain Hash Hunt,26,What is a soft fork?,A permanent split.,Backward-compatible blockchain upgrade.,A hard change.,A gentle fork.,B,hard\nBlockchain Hash Hunt,27,What is proof of stake?,A transaction type.,Proving ownership of stakes.,A mining algorithm.,Validators chosen based on cryptocurrency holdings to create blocks.,D,easy\nBlockchain Hash Hunt,28,What is proof of work?,A staking mechanism.,A wallet type.,Proving you worked.,Miners solve computational puzzles to validate blocks.,D,easy\nBlockchain Hash Hunt,29,What is a distributed ledger?,A mining tool.,A wallet type.,A single ledger.,A database replicated across multiple nodes in network.,D,easy\nBlockchain Hash Hunt,30,What is transparency in blockchain?,All transactions are visible to network participants.,Private data.,Encrypted everything.,Hidden transactions.,A,easy\nBlockchain Hash Hunt,31,What is a cryptocurrency?,Paper money.,A consensus algorithm.,A mining tool.,Digital currency using cryptography on blockchain.,D,easy\nBlockchain Hash Hunt,32,What is Bitcoin?,A blockchain platform.,A mining algorithm.,The first and most well-known cryptocurrency.,A physical coin.,C,easy\nBlockchain Hash Hunt,33,What is Ethereum?,A blockchain platform supporting smart contracts and dApps.,A wallet type.,A mining algorithm.,A type of Bitcoin.,A,easy\nBlockchain Hash Hunt,34,What is a dApp?,A mining tool.,A wallet type.,A phone app.,Decentralized application running on blockchain.,D,easy\nBlockchain Hash Hunt,35,What is tokenization?,A consensus mechanism.,Representing real-world assets as digital tokens on blockchain.,A mining process.,Creating physical tokens.,B,easy\nBlockchain Hash Hunt,36,What is an altcoin?,A mining algorithm.,Any cryptocurrency other than Bitcoin.,A wallet type.,Alternative coin.,B,easy\nBlockchain Hash Hunt,37,What is a blockchain explorer?,A tool to view and search blockchain transactions and blocks.,A person exploring.,A mining tool.,A wallet type.,A,easy\nBlockchain Hash Hunt,38,What is finality in blockchain?,A mining reward.,The end of blockchain.,A consensus type.,Assurance that transaction cannot be reversed or altered.,D,hard\nBlockchain Hash Hunt,39,What is sharding?,A wallet type.,Splitting blockchain into smaller pieces for scalability.,A mining technique.,Breaking glass.,B,hard\nBlockchain Hash Hunt,40,What is a sidechain?,A mining algorithm.,A separate blockchain connected to main chain for specific purposes.,A chain on the side.,A wallet type.,B,hard\nBlockchain Hash Hunt,41,What is cross-chain?,A mining tool.,Angry chain.,Technology enabling interaction between different blockchains.,A consensus type.,C,hard\nBlockchain Hash Hunt,42,What is a validator?,A person who validates.,A miner.,A node that verifies transactions in Proof of Stake.,A wallet.,C,easy\nBlockchain Hash Hunt,43,What is slashing in PoS?,A mining technique.,Cutting prices.,Penalty for validators who act maliciously or fail duties.,A reward system.,C,hard\nBlockchain Hash Hunt,44,What is staking?,A mining process.,Placing stakes.,Locking cryptocurrency to support network and earn rewards.,A transaction type.,C,easy\nBlockchain Hash Hunt,45,What is a block reward?,A physical reward.,A transaction fee.,A penalty.,Cryptocurrency given to miner/validator for adding block.,D,easy\nBlockchain Hash Hunt,46,What is halving?,Cutting in half.,Reduction of block reward by 50% at intervals (Bitcoin).,A fork type.,A consensus change.,B,hard\nBlockchain Hash Hunt,47,What is difficulty adjustment?,A reward change.,Making things difficult.,Automatic adjustment of mining difficulty to maintain block time.,A fork type.,C,hard\nBlockchain Hash Hunt,48,What is a mempool?,Waiting area for unconfirmed transactions.,A wallet type.,A mining pool.,A swimming pool.,A,easy\nBlockchain Hash Hunt,49,What is a mining pool?,A wallet type.,A water pool.,Group of miners combining resources to increase chances.,A single miner.,C,easy\nBlockchain Hash Hunt,50,What is Byzantine Fault Tolerance?,A mining algorithm.,A wallet type.,System's ability to reach consensus despite malicious actors.,Tolerance for faults.,C,hard\nData Cleaning Ninja,1,You see two rows with identical user_id; email; and signup_date.,Keep both rows.,Randomly modify one of the emails.,Delete the entire table.,Drop one as a duplicate record.,D,easy\nData Cleaning Ninja,2,\"Dates are in mixed formats: 2025-01-10, 10/01/2025, Jan 10 2025.\",Store them as free text forever.,Leave them as-is.,Replace with current timestamp.,\"Convert all into a single canonical format (e.g., ISO 8601).\",D,hard\nData Cleaning Ninja,3,\"You find 'N/A', 'null', 'NULL', and empty strings all meaning missing data.\",Delete the entire dataset.,Leave them for variety.,Convert all to zero.,\"Standardize all to a single representation (e.g., NULL).\",D,easy\nData Cleaning Ninja,4,A numeric column has values like '$1;234.56' with currency symbols.,Remove currency symbols and convert to numeric type.,Delete the column.,Leave as-is.,Convert to text.,A,easy\nData Cleaning Ninja,5,You find email addresses with leading/trailing spaces.,Keep the spaces.,Delete the emails.,Trim whitespace from all string fields.,Add more spaces.,C,easy\nData Cleaning Ninja,6,Phone numbers are in different formats: (123)456-7890 vs 1234567890.,Standardize to one format.,Keep all formats.,Randomize formats.,Delete phone numbers.,A,easy\nData Cleaning Ninja,7,You find outliers: ages of 0; 150; and 999.,Keep all values.,Delete all ages.,Set all to average.,Investigate and handle based on context (cap/remove/impute).,D,easy\nData Cleaning Ninja,8,Column names have spaces and special characters.,Keep them.,Delete columns.,Add more special characters.,Rename to snake_case or camelCase without special chars.,D,easy\nData Cleaning Ninja,9,You find duplicate column names.,Keep duplicates.,Merge columns.,Delete all duplicates.,Rename to make unique.,D,easy\nData Cleaning Ninja,10,Text fields have inconsistent casing: 'USA' vs 'usa' vs 'Usa'.,Delete the field.,Randomize casing.,Keep variety.,Standardize casing (all upper or all lower).,D,easy\nData Cleaning Ninja,11,You find negative values in a 'quantity sold' column.,Delete all negatives.,Keep negatives.,Convert to positive.,Investigate; may indicate returns or data errors.,D,easy\nData Cleaning Ninja,12,Categorical field has typos: 'Californa' vs 'California'.,Fix typos and standardize categories.,Delete the field.,Keep typos.,Add more typos.,A,easy\nData Cleaning Ninja,13,You find future dates in historical data.,Keep them.,Change to past dates.,Delete all dates.,Flag as errors and investigate source.,D,hard\nData Cleaning Ninja,14,Numeric IDs are stored as strings.,Keep as strings.,Delete IDs.,Convert to appropriate numeric type.,Add letters to IDs.,C,easy\nData Cleaning Ninja,15,You find records with all fields empty except ID.,Keep empty records.,Remove records with insufficient data.,Fill with random data.,Duplicate other records.,B,easy\nData Cleaning Ninja,16,Boolean field has values: true; false; 1; 0; yes; no; Y; N.,Delete the field.,Add more variations.,Standardize to consistent boolean representation.,Keep variety.,C,easy\nData Cleaning Ninja,17,You find impossible combinations: Male + Pregnant = Yes.,Delete all records.,Flag as data quality issue and investigate.,Keep the data.,Ignore the issue.,B,hard\nData Cleaning Ninja,18,Timestamps are in different timezones.,Delete timestamps.,Randomize timezones.,Keep mixed timezones.,Convert all to UTC or single timezone.,D,easy\nData Cleaning Ninja,19,You find special characters in numeric fields: '1;234' or '1 234'.,Add more characters.,Delete the field.,Remove separators and convert to numeric.,Keep them.,C,easy\nData Cleaning Ninja,20,Column has 95% missing values.,Fill with zeros.,Consider dropping column or investigating why data is missing.,Duplicate other columns.,Keep the column.,B,hard\nData Cleaning Ninja,21,You find encoded values without documentation: A; B; C.,Delete the column.,Document or decode values; or flag for clarification.,Add more codes.,Keep as-is.,B,hard\nData Cleaning Ninja,22,Text fields have HTML tags: <b>text</b>.,Delete the field.,Keep HTML.,Strip HTML tags to get clean text.,Add more HTML.,C,easy\nData Cleaning Ninja,23,You find negative ages or ages over 120.,Cap at reasonable range or flag as errors.,Keep all ages.,Set to average.,Delete all ages.,A,easy\nData Cleaning Ninja,24,Decimal values have inconsistent precision: 1.2 vs 1.234567.,Standardize to consistent decimal places.,Delete the field.,Keep variety.,Randomize precision.,A,easy\nData Cleaning Ninja,25,You find placeholder values: 'TBD'; 'N/A'; 'Unknown'.,Convert to NULL or standard missing value indicator.,Delete records.,Add more placeholders.,Keep placeholders.,A,easy\nData Cleaning Ninja,26,Column has mixed data types: numbers and text.,Delete the column.,Add more variety.,Keep mixed.,Separate into appropriate columns or standardize type.,D,hard\nData Cleaning Ninja,27,You find leading zeros in numeric codes: 00123.,Delete the field.,Remove all zeros.,Preserve as string if meaningful; else convert to number.,Keep leading zeros.,C,hard\nData Cleaning Ninja,28,Text has multiple spaces between words.,Normalize to single space between words.,Keep spaces.,Add more spaces.,Delete the text.,A,easy\nData Cleaning Ninja,29,You find records from year 1900 in recent data.,Delete all old dates.,Investigate if data error or legitimate historical data.,Change to current year.,Keep old dates.,B,hard\nData Cleaning Ninja,30,Column has percentage values: some with % symbol; some without.,Delete the column.,Add % to all.,Standardize format and convert to decimal.,Keep variety.,C,easy\nData Cleaning Ninja,31,You find non-ASCII characters in text fields.,Keep them.,Convert to ASCII only.,Delete all text.,Decide to keep/remove based on requirements; handle encoding.,D,easy\nData Cleaning Ninja,32,Numeric field has comma as decimal separator: 1;234.,Add more commas.,Convert to standard decimal point notation.,Delete the field.,Keep as-is.,B,easy\nData Cleaning Ninja,33,You find records with creation_date after last_modified_date.,Swap the dates.,Flag as logical inconsistency and investigate.,Keep them.,Delete records.,B,hard\nData Cleaning Ninja,34,Column has mixed units: some in kg; some in lbs.,Add more units.,Convert all to single unit system.,Delete the column.,Keep mixed units.,B,hard\nData Cleaning Ninja,35,You find exact duplicate rows (all fields identical).,Modify one field.,Keep duplicates.,Remove duplicate rows; keep one.,Delete all.,C,easy\nData Cleaning Ninja,36,Text fields have line breaks and tabs.,Delete the text.,Add more breaks.,Normalize whitespace or preserve based on requirements.,Keep them.,C,easy\nData Cleaning Ninja,37,You find negative prices in sales data.,Keep negatives.,Delete all prices.,Convert to positive.,Investigate; may indicate refunds or errors.,D,easy\nData Cleaning Ninja,38,Column has scientific notation: 1.23E+05.,Convert to standard decimal format if needed.,Add more notation.,Keep notation.,Delete the column.,A,easy\nData Cleaning Ninja,39,You find inconsistent abbreviations: 'St' vs 'Street' vs 'st'.,Standardize abbreviations.,Keep variety.,Delete addresses.,Add more variations.,A,easy\nData Cleaning Ninja,40,Categorical field has too many unique values (high cardinality).,Group into broader categories or use encoding techniques.,Keep all values.,Delete the field.,Add more values.,A,hard\nData Cleaning Ninja,41,You find records with end_date before start_date.,Keep them.,Flag as logical error and investigate.,Swap the dates.,Delete records.,B,hard\nData Cleaning Ninja,42,Column has mixed case in codes: 'ABC123' vs 'abc123'.,Keep mixed case.,Standardize to upper or lower case.,Delete the column.,Randomize case.,B,easy\nData Cleaning Ninja,43,You find ZIP codes with and without leading zeros: 01234 vs 1234.,Preserve as string with leading zeros.,Delete ZIP codes.,Remove all zeros.,Keep variety.,A,hard\nData Cleaning Ninja,44,Text has URLs and email addresses mixed with content.,Extract URLs/emails to separate fields or remove.,Keep mixed.,Delete all text.,Add more URLs.,A,easy\nData Cleaning Ninja,45,You find records with impossible dates: Feb 30.,Delete all dates.,Keep them.,Flag as invalid and investigate source.,Change to valid date.,C,hard\nData Cleaning Ninja,46,Column has values in different languages.,Delete the column.,Keep mixed languages.,Standardize to one language or separate by language.,Add more languages.,C,hard\nData Cleaning Ninja,47,You find negative durations or time values.,Investigate and correct based on context.,Keep negatives.,Convert to positive.,Delete all times.,A,easy\nData Cleaning Ninja,48,Numeric field has values like 'N/A' mixed with numbers.,Convert N/A to zero.,Delete the field.,Keep mixed.,Separate text and numeric; convert N/A to NULL.,D,easy\nData Cleaning Ninja,49,You find records with all caps text: 'JOHN SMITH'.,Convert to proper case based on requirements.,Add more caps.,Keep all caps.,Delete the text.,A,easy\nData Cleaning Ninja,50,Column has inconsistent null representations across rows.,Keep variety.,Delete the column.,Add more variations.,Standardize all null representations to single format.,D,easy\nSchema Validator Lab,1,\"Schema requires user_id (INT, NOT NULL, PK). You see rows with NULL user_id. What's the issue?\",\"No issue, PKs can be NULL.\",Violation of PK and NOT NULL constraint.,Only a performance warning.,Just a formatting concern.,B,easy\nSchema Validator Lab,2,\"Your app reads column created_at, but the DB schema changed it to created_timestamp. What is this called?\",Query normalization.,Data cleaning.,Schema drift / breaking change.,Index optimization.,C,hard\nSchema Validator Lab,3,A foreign key references a non-existent primary key. What's the issue?,Just a warning; not an error.,\"No issue, foreign keys are optional.\",Referential integrity violation - data inconsistency.,The database will auto-create the missing key.,C,hard\nSchema Validator Lab,4,Column defined as VARCHAR(10) receives 50-character string. What happens?,Automatically expands.,Truncated or error depending on database settings.,Converts to number.,Stored completely.,B,easy\nSchema Validator Lab,5,Schema expects NOT NULL but application sends NULL. What's the issue?,Database fills with default.,No problem.,Constraint violation - insert/update will fail.,Just a warning.,C,easy\nSchema Validator Lab,6,You add a new required column without default value. What happens to existing rows?,Rows deleted.,Automatically filled.,Existing rows violate NOT NULL; migration fails or needs default.,No issue.,C,hard\nSchema Validator Lab,7,Schema has UNIQUE constraint but duplicate values inserted. What happens?,Constraint violation - second insert fails.,Both merged.,First one deleted.,Both stored.,A,easy\nSchema Validator Lab,8,Column type changed from INT to VARCHAR. What's the risk?,No risk.,Better storage.,Faster queries.,Data type mismatch; queries may break; performance impact.,D,hard\nSchema Validator Lab,9,Schema has CHECK constraint (age > 0) but negative value inserted. What happens?,Value stored.,Constraint ignored.,Constraint violation - insert fails.,Value converted to positive.,C,easy\nSchema Validator Lab,10,You drop a column that application code still references. What happens?,No issue.,Runtime errors when code tries to access missing column.,Column recreated.,Code auto-updates.,B,easy\nSchema Validator Lab,11,Schema has index on column but queries don't use it. What's the issue?,Index is perfect.,No issue.,Query not optimized; may need query rewrite or different index.,Index is broken.,C,hard\nSchema Validator Lab,12,Two tables have circular foreign key dependencies. What's the risk?,Faster queries.,Better integrity.,No risk.,Complex to maintain; can cause insertion/deletion issues.,D,hard\nSchema Validator Lab,13,Schema allows NULL in foreign key column. Is this valid?,Valid; NULL means no relationship.,Never valid.,Depends on moon phase.,Always invalid.,A,easy\nSchema Validator Lab,14,Column has DEFAULT value but application always provides value. What happens?,Default never used; no issue but redundant.,Default overrides application.,Database crashes.,Error occurs.,A,easy\nSchema Validator Lab,15,Schema has composite primary key but application treats single column as PK. What's the risk?,Faster queries.,Data integrity issues; duplicates possible.,Better performance.,No risk.,B,hard\nSchema Validator Lab,16,You rename a table without updating application code. What happens?,Application errors when trying to access old table name.,No issue.,Code auto-updates.,Table auto-renames back.,A,easy\nSchema Validator Lab,17,Schema has ON DELETE CASCADE but application expects manual deletion. What's the risk?,Unexpected data deletion when parent record deleted.,No risk.,Faster deletions.,Better integrity.,A,hard\nSchema Validator Lab,18,Column precision changed from DECIMAL(10;2) to DECIMAL(10;4). What's the impact?,More precision stored; existing data unchanged; queries may need update.,Performance worse.,No impact.,Data corrupted.,A,easy\nSchema Validator Lab,19,Schema has trigger but application doesn't account for it. What's the risk?,Better data.,Faster operations.,No risk.,Unexpected side effects; data changes application doesn't expect.,D,hard\nSchema Validator Lab,20,You add index on large text column. What's the consideration?,May impact write performance; consider partial index.,No impact.,Always good.,Always bad.,A,hard\nSchema Validator Lab,21,Schema has ENUM type but application sends value not in list. What happens?,Insert fails with constraint violation.,Value stored.,Value converted.,ENUM expands.,A,easy\nSchema Validator Lab,22,Two schemas (dev and prod) are out of sync. What's the risk?,No risk.,Better testing.,Faster development.,Code works in dev but fails in prod; deployment issues.,D,hard\nSchema Validator Lab,23,Schema has auto-increment PK but application manually sets values. What's the risk?,Faster inserts.,Sequence conflicts; duplicate key errors possible.,Better control.,No risk.,B,hard\nSchema Validator Lab,24,Column has index but low cardinality (few unique values). What's the impact?,Index may not be used; limited benefit.,No impact.,Always beneficial.,Always harmful.,A,hard\nSchema Validator Lab,25,Schema allows very long VARCHAR but typical data is short. What's the consideration?,Always wrong.,May waste space; consider appropriate length.,Perfect design.,No impact.,B,easy\nSchema Validator Lab,26,You change column from NULL to NOT NULL without data migration. What happens?,Existing NULL rows cause constraint violation.,NULLs auto-convert.,Column unchanged.,No issue.,A,easy\nSchema Validator Lab,27,Schema has many-to-many relationship without junction table. What's the issue?,Cannot properly model relationship; data integrity problems.,Simpler design.,No issue.,Faster queries.,A,easy\nSchema Validator Lab,28,Column stores JSON but schema doesn't validate structure. What's the risk?,Invalid JSON stored; application errors when parsing.,Faster storage.,Better flexibility.,No risk.,A,hard\nSchema Validator Lab,29,Schema has timestamp without timezone info. What's the risk?,Ambiguity in multi-timezone applications; data interpretation issues.,Faster queries.,No risk.,Smaller storage.,A,hard\nSchema Validator Lab,30,You add column with same name as reserved keyword. What happens?,May require quoting in queries; potential syntax errors.,Auto-renamed.,Database crashes.,No issue.,A,easy\nSchema Validator Lab,31,Schema has no primary key on table. What's the issue?,Perfectly fine.,Cannot uniquely identify rows; update/delete ambiguity.,Faster inserts.,Smaller storage.,B,easy\nSchema Validator Lab,32,Column stores currency but uses FLOAT type. What's the risk?,Precision errors in calculations; use DECIMAL instead.,Perfect choice.,Smaller storage.,Faster calculations.,A,hard\nSchema Validator Lab,33,Schema has redundant data (denormalization) without update strategy. What's the risk?,Faster queries always.,Simpler design.,Data inconsistency when updates miss some copies.,No risk.,C,hard\nSchema Validator Lab,34,You change column order in schema. Does it affect application?,Always improves performance.,Always breaks application.,Never affects anything.,Usually no impact unless using SELECT * or positional access.,D,easy\nSchema Validator Lab,35,Schema has view but underlying table structure changed. What happens?,View may break or return incorrect results.,View auto-updates.,No impact.,View deleted.,A,hard\nSchema Validator Lab,36,Column has CHECK constraint but database doesn't enforce it. What's the risk?,Invalid data can be inserted; data integrity compromised.,Better performance.,Faster inserts.,No risk.,A,hard\nSchema Validator Lab,37,Schema uses CHAR instead of VARCHAR for variable-length data. What's the impact?,No difference.,Perfect choice.,Always better.,Wasted space with padding; consider VARCHAR.,D,easy\nSchema Validator Lab,38,You add NOT NULL constraint to column with existing NULLs. What happens?,Constraint added successfully.,NULLs auto-convert.,Constraint addition fails; must handle NULLs first.,Column deleted.,C,easy\nSchema Validator Lab,39,Schema has cascading foreign keys creating circular dependency. What's the risk?,Better integrity.,No risk.,Deletion/update operations may fail or cause unexpected cascades.,Faster operations.,C,hard\nSchema Validator Lab,40,Column stores dates as strings (YYYY-MM-DD). What's the issue?,Faster storage.,Cannot use date functions; sorting issues; use DATE type.,Perfect design.,More flexible.,B,easy\nSchema Validator Lab,41,Schema has index on every column. What's the impact?,Always beneficial.,No impact.,Always harmful.,Slower writes; wasted space; only index what's needed.,D,easy\nSchema Validator Lab,42,You change column from UNIQUE to non-unique. What's the impact on existing data?,No impact on existing data; future duplicates allowed.,Data duplicated.,Constraint remains.,Data deleted.,A,easy\nSchema Validator Lab,43,Schema has no foreign key constraints but application assumes relationships. What's the risk?,No risk.,Orphaned records; referential integrity not enforced.,Simpler design.,Faster operations.,B,hard\nSchema Validator Lab,44,Column defined as BOOLEAN but stores 0/1/NULL. Is this valid?,Valid in most databases; NULL means unknown.,Never valid.,Invalid always.,Valid only with NULL.,A,easy\nSchema Validator Lab,45,Schema has materialized view but refresh strategy undefined. What's the risk?,Stale data; queries return outdated results.,Faster queries always.,No risk.,Better performance.,A,hard\nSchema Validator Lab,46,You add column with default value. Do existing rows get the default?,Rows deleted.,Depends on database; usually only new rows.,Yes always.,No never.,B,hard\nSchema Validator Lab,47,Schema has TEXT column with index. What's the consideration?,Always bad.,No impact.,May need prefix index; full-text index for search.,Always good.,C,hard\nSchema Validator Lab,48,Column stores boolean as VARCHAR ('true'/'false'). What's the issue?,More flexible.,Perfect design.,Faster queries.,Inefficient storage; use BOOLEAN type; validation issues.,D,easy\nSchema Validator Lab,49,Schema has multiple nullable columns in composite key. What's the consideration?,Always invalid.,No issue.,NULL handling in keys is complex; consider design.,Always valid.,C,hard\nSchema Validator Lab,50,You change column collation. What's the impact?,Affects sorting and comparison; may break queries/indexes.,No impact.,Always improves performance.,Always breaks everything.,A,hard\nCrypto-for-Data Puzzle,1,Which key should remain secret in a standard public-key encryption scheme?,Public key,Both keys must be public,Neither; keys are irrelevant,Private key,D,easy\nCrypto-for-Data Puzzle,2,You compute SHA-256 over a file. What property are you primarily using?,Random number generation,Reversibility,Collision resistance and integrity checking,Encryption,C,hard\nCrypto-for-Data Puzzle,3,What's the main difference between encryption and hashing?,Encryption is reversible; hashing is one-way.,Encryption only works on text.,They're the same thing.,Hashing is faster but less secure.,A,easy\nCrypto-for-Data Puzzle,4,What is symmetric encryption?,Using no keys.,Using different keys for encryption and decryption.,Using three keys.,Using the same key for both encryption and decryption.,D,easy\nCrypto-for-Data Puzzle,5,What is asymmetric encryption?,Using no encryption.,Using symmetric keys.,Using public and private key pair.,Using same key for both operations.,C,easy\nCrypto-for-Data Puzzle,6,What is a digital signature used for?,To verify authenticity and integrity of digital messages.,To sign documents physically.,To encrypt data.,To compress files.,A,easy\nCrypto-for-Data Puzzle,7,What is a salt in password hashing?,A seasoning.,A hash function.,A type of encryption.,Random data added to password before hashing to prevent rainbow table attacks.,D,hard\nCrypto-for-Data Puzzle,8,What is the purpose of a nonce in cryptography?,To make sense.,A number used once to prevent replay attacks.,A type of key.,An encryption algorithm.,B,hard\nCrypto-for-Data Puzzle,9,What is AES?,A hash function.,Advanced Encryption Standard - symmetric encryption algorithm.,A car brand.,An asymmetric algorithm.,B,easy\nCrypto-for-Data Puzzle,10,What is RSA?,A symmetric algorithm.,Asymmetric encryption algorithm using public/private keys.,A government agency.,A hash function.,B,easy\nCrypto-for-Data Puzzle,11,What is a hash collision?,Two different inputs producing the same hash output.,A key exchange method.,Two hashes colliding physically.,A type of encryption.,A,hard\nCrypto-for-Data Puzzle,12,What is the purpose of HTTPS?,To cache pages.,To encrypt communication between browser and server.,To make websites faster.,To compress data.,B,easy\nCrypto-for-Data Puzzle,13,What is a certificate authority (CA)?,A government office.,An encryption algorithm.,Trusted entity that issues digital certificates.,A hash function.,C,easy\nCrypto-for-Data Puzzle,14,What is end-to-end encryption?,Encryption at endpoints only.,Encryption where only communicating parties can read messages.,Partial encryption.,No encryption.,B,easy\nCrypto-for-Data Puzzle,15,What is a rainbow table?,A colorful table.,An encryption method.,Precomputed table of hash values for password cracking.,A key storage system.,C,hard\nCrypto-for-Data Puzzle,16,What is key exchange?,Exchanging physical keys.,A hash function.,A type of encryption.,Process of securely sharing encryption keys between parties.,D,easy\nCrypto-for-Data Puzzle,17,What is Diffie-Hellman?,A hash function.,An encryption algorithm.,Key exchange protocol for secure key sharing.,A person's name only.,C,hard\nCrypto-for-Data Puzzle,18,What is a cipher?,A hash function.,A secret code.,Algorithm for encryption and decryption.,A key type.,C,easy\nCrypto-for-Data Puzzle,19,What is plaintext?,Compressed data.,Plain text format.,Encrypted data.,Unencrypted readable data.,D,easy\nCrypto-for-Data Puzzle,20,What is ciphertext?,Text about ciphers.,Encrypted data that appears random.,Unencrypted data.,Compressed data.,B,easy\nCrypto-for-Data Puzzle,21,What is a brute force attack?,A hash function.,Trying all possible keys/passwords until finding the right one.,A type of encryption.,Physical force.,B,easy\nCrypto-for-Data Puzzle,22,What is key length's impact on security?,Length doesn't matter.,Shorter is better.,Longer keys generally provide stronger security.,No impact.,C,easy\nCrypto-for-Data Puzzle,23,What is a man-in-the-middle attack?,Attacker intercepts communication between two parties.,A type of encryption.,A hash function.,A person standing in middle.,A,easy\nCrypto-for-Data Puzzle,24,What is perfect forward secrecy?,An encryption standard.,A type of hash.,Perfect encryption.,Session keys not compromised even if long-term keys are.,D,hard\nCrypto-for-Data Puzzle,25,What is a block cipher?,Encrypts streams.,A hash function.,Blocking ciphers.,Encrypts data in fixed-size blocks.,D,easy\nCrypto-for-Data Puzzle,26,What is a stream cipher?,A hash function.,Encrypts data one bit/byte at a time.,Streaming video.,Encrypts blocks.,B,easy\nCrypto-for-Data Puzzle,27,What is initialization vector (IV)?,A hash function.,Random value used with encryption to ensure uniqueness.,A type of key.,A starting vector.,B,hard\nCrypto-for-Data Puzzle,28,What is padding in encryption?,Adding cushions.,Compressing data.,Adding extra data to reach required block size.,Removing data.,C,easy\nCrypto-for-Data Puzzle,29,What is a cryptographic hash function?,One-way function producing fixed-size output from any input.,A function that hashes.,A two-way function.,An encryption method.,A,easy\nCrypto-for-Data Puzzle,30,What is MD5?,An encryption algorithm.,A key type.,Hash function (now considered weak for security).,A vitamin.,C,easy\nCrypto-for-Data Puzzle,31,What is SHA?,A key exchange.,An encryption method.,A sound.,Secure Hash Algorithm family.,D,easy\nCrypto-for-Data Puzzle,32,What is a key derivation function (KDF)?,Deriving keys from locks.,An encryption algorithm.,A hash function.,Function to derive cryptographic keys from passwords.,D,hard\nCrypto-for-Data Puzzle,33,What is PBKDF2?,A robot name.,An encryption algorithm.,A hash function.,Password-Based Key Derivation Function 2.,D,hard\nCrypto-for-Data Puzzle,34,What is bcrypt?,Password hashing function designed to be slow.,A key exchange.,A currency.,An encryption algorithm.,A,hard\nCrypto-for-Data Puzzle,35,What is a timing attack?,Exploiting time differences in operations to extract secrets.,Attacking at specific time.,A hash function.,A type of encryption.,A,hard\nCrypto-for-Data Puzzle,36,What is authenticated encryption?,Encryption that also verifies data integrity and authenticity.,No authentication.,Encryption with authentication.,Simple encryption.,A,hard\nCrypto-for-Data Puzzle,37,What is GCM mode?,A key type.,A hash function.,Galois/Counter Mode - authenticated encryption mode.,A car mode.,C,hard\nCrypto-for-Data Puzzle,38,What is a key management system?,An encryption algorithm.,Managing physical keys.,System for securely generating/storing/distributing cryptographic keys.,A hash function.,C,easy\nCrypto-for-Data Puzzle,39,What is key rotation?,Regularly changing encryption keys for security.,Rotating keys physically.,A hash function.,A type of encryption.,A,easy\nCrypto-for-Data Puzzle,40,What is a hardware security module (HSM)?,Software only.,A computer module.,Physical device for managing and storing cryptographic keys.,A hash function.,C,hard\nCrypto-for-Data Puzzle,41,What is quantum-resistant cryptography?,Cryptography designed to withstand quantum computer attacks.,Resisting quantum physics.,A hash function.,Current encryption.,A,hard\nCrypto-for-Data Puzzle,42,What is a side-channel attack?,A hash function.,A type of encryption.,Exploiting physical implementation (power/timing/EM) to extract secrets.,Attacking from the side.,C,hard\nCrypto-for-Data Puzzle,43,What is homomorphic encryption?,Similar encryption.,Standard encryption.,Encryption allowing computation on encrypted data without decrypting.,A hash function.,C,hard\nCrypto-for-Data Puzzle,44,What is zero-knowledge proof?,Proving nothing.,A hash function.,Proving knowledge of secret without revealing the secret itself.,Revealing everything.,C,hard\nCrypto-for-Data Puzzle,45,What is a cryptographic protocol?,An encryption algorithm.,A hash function.,Set of rules for secure communication using cryptography.,A medical protocol.,C,easy\nCrypto-for-Data Puzzle,46,What is TLS?,A hash function.,A disease.,Transport Layer Security - protocol for secure communication.,An encryption algorithm.,C,easy\nCrypto-for-Data Puzzle,47,What is a replay attack?,A hash function.,Reusing captured valid data transmission maliciously.,A type of encryption.,Replaying videos.,B,easy\nCrypto-for-Data Puzzle,48,What is key escrow?,Storing encryption keys with third party for recovery.,Escrow service.,A type of encryption.,A hash function.,A,hard\nCrypto-for-Data Puzzle,49,What is steganography?,Hiding messages within other non-secret data.,A hash function.,Encryption method.,Study of dinosaurs.,A,hard\nCrypto-for-Data Puzzle,50,What is a cryptographic primitive?,Basic cryptographic algorithm used as building block.,A complete protocol.,An advanced system.,A primitive tool.,A,hard\nQuery Optimizer Race,1,Table orders has an index on customer_id. Which query is likely faster?,SELECT * FROM orders WHERE customer_id = 42;,SELECT * FROM orders WHERE amount + 10 > 1000;,Both are equally fast.,Neither will work.,A,easy\nQuery Optimizer Race,2,You're joining large orders with small customers. Which approach is typically better?,Start with the larger table and use index on join column.,Start with the smaller table always.,Join order doesn't matter.,Avoid joins entirely.,A,hard\nQuery Optimizer Race,3,Which SQL operation is generally most expensive?,SELECT with indexed WHERE clause,Full table scan with complex JOIN and no indexes,Simple INSERT statement,SELECT COUNT(*) with index,B,easy\nQuery Optimizer Race,4,What does EXPLAIN or EXPLAIN ANALYZE do?,Deletes the query plan.,Shows the execution plan and how the database will run the query.,Speeds up the query.,Creates an index.,B,easy\nQuery Optimizer Race,5,When should you use an index?,On columns frequently used in WHERE clauses and JOINs.,On every column.,Never use indexes.,Only on primary keys.,A,easy\nQuery Optimizer Race,6,What is a covering index?,An index that includes all columns needed by a query.,An index that covers the entire table.,A backup index.,An index on the primary key only.,A,hard\nQuery Optimizer Race,7,Which is faster for finding one row by primary key?,Index seek,Full table scan,Hash join,Nested loop without index,A,easy\nQuery Optimizer Race,8,What causes index fragmentation?,Frequent inserts/updates/deletes causing scattered data.,Too many SELECT queries.,Using too few indexes.,Reading data too fast.,A,hard\nQuery Optimizer Race,9,When might a full table scan be faster than an index scan?,When selecting most rows from a small table.,Never.,When the table has many indexes.,When using primary key.,A,hard\nQuery Optimizer Race,10,What is query plan caching?,Storing execution plans for reuse to avoid re-optimization.,Caching query results.,Storing queries in memory.,Deleting old queries.,A,easy\nQuery Optimizer Race,11,Which JOIN type typically performs best with proper indexes?,INNER JOIN with indexed columns.,CROSS JOIN.,Cartesian product.,Subquery in SELECT.,A,easy\nQuery Optimizer Race,12,What is the N+1 query problem?,Executing N additional queries for N rows instead of one efficient query.,Having N+1 tables.,Using N+1 indexes.,Running queries N+1 times.,A,hard\nQuery Optimizer Race,13,How can you optimize SELECT * queries?,Select only needed columns instead of *.,Always use SELECT *.,Add more indexes.,Use DISTINCT.,A,easy\nQuery Optimizer Race,14,What is query parallelization?,Splitting query execution across multiple CPU cores.,Running queries one at a time.,Duplicating queries.,Slowing down queries.,A,hard\nQuery Optimizer Race,15,Which is more efficient for large result sets?,Pagination with LIMIT/OFFSET or keyset pagination.,Fetching all rows at once.,Using SELECT *.,Avoiding WHERE clauses.,A,easy\nQuery Optimizer Race,16,What is index selectivity?,How well an index narrows down results (high = better).,The number of indexes.,Index size.,Index creation time.,A,hard\nQuery Optimizer Race,17,When should you use EXISTS vs IN?,EXISTS for large subqueries; IN for small lists.,Always use IN.,Always use EXISTS.,They're identical.,A,hard\nQuery Optimizer Race,18,What is a composite index?,An index on multiple columns.,An index made of other indexes.,A temporary index.,An index on one column.,A,easy\nQuery Optimizer Race,19,How does ORDER BY affect performance?,Can be slow without index on sort column; may require filesort.,ORDER BY is always fast.,ORDER BY doesn't affect performance.,ORDER BY creates indexes.,A,easy\nQuery Optimizer Race,20,What is query rewriting?,Optimizer transforming query to more efficient form.,Manually editing queries.,Deleting queries.,Copying queries.,A,hard\nQuery Optimizer Race,21,Which aggregation is typically fastest?,COUNT(*) with proper index.,AVG() on unindexed column.,SUM() with GROUP BY on large table.,Complex nested aggregations.,A,easy\nQuery Optimizer Race,22,What is a hash join?,Join using hash table for matching rows; good for large unsorted data.,Join using nested loops.,Join using indexes only.,Join using sorting.,A,hard\nQuery Optimizer Race,23,When is UNION ALL faster than UNION?,When you don't need to remove duplicates.,Never.,When there are duplicates.,When tables are small.,A,easy\nQuery Optimizer Race,24,What is predicate pushdown?,Moving filter conditions closer to data source for early filtering.,Pushing queries to another server.,Delaying filter execution.,Removing predicates.,A,hard\nQuery Optimizer Race,25,How can subqueries affect performance?,Correlated subqueries can be slow; consider JOINs or CTEs.,Subqueries are always fast.,Subqueries don't affect performance.,Always use subqueries.,A,hard\nQuery Optimizer Race,26,What is the benefit of prepared statements for performance?,Query plan can be cached and reused.,No performance benefit.,Slower than regular queries.,Only for security.,A,easy\nQuery Optimizer Race,27,Which is faster for checking existence?,EXISTS (stops at first match).,COUNT(*) > 0.,SELECT * and check rows.,DISTINCT query.,A,easy\nQuery Optimizer Race,28,What is partition pruning?,Optimizer skipping irrelevant partitions based on query conditions.,Deleting partitions.,Creating new partitions.,Merging partitions.,A,hard\nQuery Optimizer Race,29,How does DISTINCT affect performance?,Can be slow; requires sorting or hashing to remove duplicates.,DISTINCT is always fast.,No performance impact.,DISTINCT speeds up queries.,A,easy\nQuery Optimizer Race,30,What is a materialized view?,Pre-computed query results stored for fast access.,A regular view.,A temporary table.,An index type.,A,hard\nQuery Optimizer Race,31,When should you denormalize data?,When read performance is critical and joins are expensive.,Always denormalize.,Never denormalize.,Only for small tables.,A,hard\nQuery Optimizer Race,32,What is connection pooling?,Reusing database connections to avoid connection overhead.,Creating new connections each time.,Pooling queries.,Caching results.,A,easy\nQuery Optimizer Race,33,Which is more efficient for bulk inserts?,Batch INSERT with multiple rows.,Individual INSERT for each row.,Using SELECT INTO.,Using UPDATE.,A,easy\nQuery Optimizer Race,34,What is query timeout?,Maximum time allowed for query execution before cancellation.,Time to write query.,Time to create index.,Connection time.,A,easy\nQuery Optimizer Race,35,How can you optimize GROUP BY?,Ensure columns are indexed; consider pre-aggregation.,GROUP BY is always fast.,Avoid GROUP BY entirely.,Use GROUP BY on all columns.,A,easy\nQuery Optimizer Race,36,What is a query hint?,Directive to optimizer to use specific execution strategy.,A comment in query.,Query documentation.,Error message.,A,hard\nQuery Optimizer Race,37,When is LIKE with leading wildcard slow?,Always slow because it can't use index effectively.,Never slow.,Only on small tables.,Only with trailing wildcard.,A,easy\nQuery Optimizer Race,38,What is cardinality in query optimization?,Number of unique values in a column; affects index effectiveness.,Number of rows.,Number of columns.,Number of tables.,A,hard\nQuery Optimizer Race,39,How does NULL affect index usage?,NULLs may not be indexed; IS NULL queries might not use index.,NULLs are always indexed.,NULLs speed up queries.,NULLs have no effect.,A,hard\nQuery Optimizer Race,40,What is the benefit of query batching?,Reduces round trips to database; improves throughput.,No benefit.,Slows down queries.,Only for SELECT.,A,easy\nQuery Optimizer Race,41,Which is faster for large deletes?,DELETE in batches or TRUNCATE if deleting all.,DELETE all at once.,DROP and recreate table.,UPDATE to NULL.,A,hard\nQuery Optimizer Race,42,What is index-only scan?,Query satisfied entirely from index without accessing table.,Scanning only one index.,Ignoring indexes.,Full table scan.,A,hard\nQuery Optimizer Race,43,How can you optimize HAVING clause?,Move conditions to WHERE when possible; HAVING is post-aggregation.,HAVING is always fast.,Always use HAVING.,Avoid HAVING.,A,hard\nQuery Optimizer Race,44,What is query cost estimation?,Optimizer's prediction of resources needed to execute query.,Actual query execution time.,Database licensing cost.,Storage cost.,A,easy\nQuery Optimizer Race,45,When should you use temporary tables?,For complex queries with intermediate results used multiple times.,Never use temp tables.,Always use temp tables.,Only for small data.,A,hard\nQuery Optimizer Race,46,What is a nested loop join?,Join that iterates through one table for each row of another.,Join using hash table.,Join using merge sort.,Join using index only.,A,easy\nQuery Optimizer Race,47,How does data type mismatch affect queries?,Can prevent index usage and cause implicit conversions.,No effect.,Speeds up queries.,Only affects INSERT.,A,hard\nQuery Optimizer Race,48,What is query plan stability?,Consistent execution plans across runs; important for predictable performance.,Plans changing randomly.,No plan at all.,Plan deletion.,A,hard\nQuery Optimizer Race,49,When is sorting expensive?,On large datasets without index on sort column.,Sorting is always cheap.,Only on small datasets.,Never expensive.,A,easy\nQuery Optimizer Race,50,What is the optimizer's goal?,Find the most efficient execution plan for a query.,Make queries slower.,Use all indexes.,Avoid using indexes.,A,easy";
/****************************************************
   * GLOBAL STATE
   ****************************************************/
  const appState = {
    score: 0,
    currentWorldId: "escape",
    gameWon: false,
    worlds: {
      escape: { id: "escape", name: "AI Escape Room", completed: false },
      mlbuilder: { id: "mlbuilder", name: "ML Model Builder", completed: false },
      prompt: { id: "prompt", name: "GenAI Prompt Arena", completed: false },
      chain: { id: "chain", name: "Blockchain Hash Hunt", completed: false },
      clean: { id: "clean", name: "Data Cleaning Ninja", completed: false },
      schema: { id: "schema", name: "Schema Validator Lab", completed: false },
      query: { id: "query", name: "Query Optimizer Race", completed: false },
      crypto: { id: "crypto", name: "Crypto-for-Data Puzzle", completed: false },
    },
    timers: {
      escape: { secondsLeft: 45, intervalId: null },
    },
    csvQuestions: {}, // Will store questions loaded from CSV
    csvLoaded: false, // Flag to track if CSV has been loaded
    usedQuestions: {}, // Track used question indices per world to prevent repeats
  };

  /****************************************************
   * PERSISTENT QUESTION TRACKING - Uses localStorage
   ****************************************************/
  const STORAGE_KEY = 'agentZero_usedQuestions';

  function loadUsedQuestionsFromStorage() {
    try {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) {
        const parsed = JSON.parse(stored);
        // Convert arrays back to Sets
        Object.keys(parsed).forEach(worldId => {
          appState.usedQuestions[worldId] = new Set(parsed[worldId]);
        });
        console.log('ðŸ“‚ Loaded used questions from storage');
      }
    } catch (e) {
      console.warn('Could not load used questions from storage:', e);
    }
  }

  function saveUsedQuestionsToStorage() {
    try {
      // Convert Sets to arrays for JSON storage
      const toStore = {};
      Object.keys(appState.usedQuestions).forEach(worldId => {
        toStore[worldId] = Array.from(appState.usedQuestions[worldId]);
      });
      localStorage.setItem(STORAGE_KEY, JSON.stringify(toStore));
    } catch (e) {
      console.warn('Could not save used questions to storage:', e);
    }
  }

  function clearUsedQuestionsStorage() {
    try {
      localStorage.removeItem(STORAGE_KEY);
      appState.usedQuestions = {};
      console.log('ðŸ—‘ï¸ Cleared all used questions history');
    } catch (e) {
      console.warn('Could not clear storage:', e);
    }
  }

  /****************************************************
   * CSV LOADER - Load questions from CSV file
   ****************************************************/
  function parseCSVLine(line) {
    const result = [];
    let current = '';
    let inQuotes = false;
    
    for (let i = 0; i < line.length; i++) {
      const char = line[i];
      
      if (char === '"') {
        inQuotes = !inQuotes;
      } else if (char === ',' && !inQuotes) {
        result.push(current.trim());
        current = '';
      } else {
        current += char;
      }
    }
    result.push(current.trim());
    return result;
  }

  async function loadQuestionsFromCSV() {
    try {
      // Use embedded CSV data (works without server)
      // Falls back to fetch if embedded data not available
      let csvText;
      if (typeof EMBEDDED_CSV_DATA !== 'undefined' && EMBEDDED_CSV_DATA) {
        csvText = EMBEDDED_CSV_DATA;
        console.log('ðŸ“¦ Using embedded CSV data');
      } else {
        const response = await fetch('ALL_QUESTIONS_MASTER.csv');
        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }
        csvText = await response.text();
        console.log('ðŸŒ Loaded CSV from file');
      }
      const lines = csvText.split('\n').slice(1); // Skip header
      
      const worldMap = {
        'AI Escape Room': 'escape',
        'ML Model Builder': 'mlbuilder',
        'GenAI Prompt Arena': 'prompt',
        'Blockchain Hash Hunt': 'chain',
        'Data Cleaning Ninja': 'clean',
        'Schema Validator Lab': 'schema',
        'Query Optimizer Race': 'query',
        'Crypto-for-Data Puzzle': 'crypto'
      };
      
      lines.forEach(line => {
        if (!line.trim()) return;
        
        const parts = parseCSVLine(line);
        if (parts.length < 9) return;
        
        const worldName = parts[0];
        const worldId = worldMap[worldName];
        if (!worldId) return;
        
        const questionNum = parts[1];
        const question = parts[2];
        const optionA = parts[3];
        const optionB = parts[4];
        const optionC = parts[5];
        const optionD = parts[6];
        const correctAnswer = parts[7];
        const difficulty = parts[8].trim().toLowerCase();
        
        const correctIndex = {'a': 0, 'b': 1, 'c': 2, 'd': 3}[correctAnswer.toLowerCase()] || 0;
        
        if (!appState.csvQuestions[worldId]) {
          appState.csvQuestions[worldId] = [];
        }
        
        // Build question object with all needed fields
        const questionObj = {
          question: question,
          options: [optionA, optionB, optionC, optionD],
          correctIndex: correctIndex,
          difficulty: difficulty,
          positive: "âœ… Correct! Great job!",
          negative: "âŒ Not quite right. Try again!",
        };
        
        // Add extra fields for specific worlds
        if (worldId === 'mlbuilder') {
          questionObj.id = `q${questionNum}`;
          questionObj.label = `Step ${questionNum}`;
        }
        if (worldId === 'prompt') {
          questionObj.type = 'mcq';
          questionObj.title = `Prompt Challenge ${questionNum}`;
        }
        if (worldId === 'query') {
          questionObj.labels = ['Option A', 'Option B'];
        }
        
        appState.csvQuestions[worldId].push(questionObj);
      });
      
      console.log('âœ… Questions loaded from CSV successfully!');
      Object.keys(appState.csvQuestions).forEach(world => {
        console.log(`  ${world}: ${appState.csvQuestions[world].length} questions`);
      });
      
      // Verify all worlds have questions
      const requiredWorlds = ['escape', 'mlbuilder', 'prompt', 'chain', 'clean', 'schema', 'query', 'crypto'];
      const missingWorlds = requiredWorlds.filter(w => !appState.csvQuestions[w] || appState.csvQuestions[w].length === 0);
      if (missingWorlds.length > 0) {
        console.error('âŒ Missing questions for worlds:', missingWorlds.join(', '));
        alert('Warning: Some game worlds are missing questions. Please check ALL_QUESTIONS_MASTER.csv');
      }
      
      appState.csvLoaded = true;
      
    } catch (error) {
      console.error('âŒ CRITICAL: Error loading CSV:', error);
      alert('CRITICAL ERROR: Could not load questions from ALL_QUESTIONS_MASTER.csv. The game cannot start without this file.');
      appState.csvLoaded = false;
    }
  }

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }

  function getClearedWorldsCount() {
    return Object.values(appState.worlds).filter(w => w.completed).length;
  }

  function getDifficultyLevel() {
    const cleared = getClearedWorldsCount();
    if (cleared < 2) return "easy"; // 0â€“1 worlds: easier onboarding
    return "hard";                  // 2+ worlds: ramp up difficulty
  }

  function updateGlobalHUD() {
    document.getElementById("score-display").textContent = appState.score;
    const cleared = getClearedWorldsCount();
    document.getElementById("cleared-worlds-count").textContent = cleared;
    const progressPercent = (cleared / 3) * 100;
    document.getElementById("progress-bar-inner").style.width = progressPercent + "%";

    const worldOrder = [
      "escape","mlbuilder","prompt","chain","clean","schema","query","crypto"
    ];
    const index = worldOrder.indexOf(appState.currentWorldId);
    document.getElementById("world-counter-label").textContent =
      "World " + (index + 1) + " of 8";
  }

function showScorePopup(points, isPositive) {
  const popup = document.getElementById("score-popup");
  const text = document.getElementById("score-popup-text");
  const value = document.getElementById("score-popup-value");
  
  if (!popup || !text || !value) return;
  
  // Aesthetic copy
  text.textContent = isPositive ? "Score boosted" : "Score reduced";
  const absPoints = Math.abs(points);
  value.textContent = (isPositive ? "+" : "âˆ’") + absPoints + " pts";
  
  // Set style
  popup.className = "score-popup " + (isPositive ? "positive" : "negative");
  
  // Show popup
  setTimeout(() => popup.classList.add("show"), 10);
  
  // Hide after 1.5 seconds
  setTimeout(() => {
    popup.classList.remove("show");
  }, 1500);
}

  function showWinModal() {
    const modal = document.getElementById("win-modal");
    const finalScoreDisplay = document.getElementById("final-score-display");
    if (!modal) return;
    
    // Update final score
    if (finalScoreDisplay) {
      finalScoreDisplay.textContent = appState.score;
    }
    
    modal.classList.add("active");
  }

  function hideWinModal() {
    const modal = document.getElementById("win-modal");
    if (!modal) return;
    modal.classList.remove("active");
  }

  function checkGlobalWin() {
    const cleared = getClearedWorldsCount();
    if (cleared >= 3 && !appState.gameWon) {
      playSound('win');
      appState.gameWon = true;
      showWinModal();
    }
  }

  /****************************************************
   * WORLD SELECTOR WIDGET
   ****************************************************/
  const worldDefinitions = [
    {
      id: "escape",
      label: "AI Escape Room",
      subtitle: "Clear timed knowledge locks.",
    },
    {
      id: "mlbuilder",
      label: "ML Model Builder",
      subtitle: "Design, tune, and debug a model pipeline.",
    },
    {
      id: "prompt",
      label: "GenAI Prompt Arena",
      subtitle: "Optimize prompts and mitigate hallucinations.",
    },
    {
      id: "chain",
      label: "Blockchain Hash Hunt",
      subtitle: "Locate hashes and validate blocks.",
    },
    {
      id: "clean",
      label: "Data Cleaning Ninja",
      subtitle: "Normalize, dedupe, and repair datasets.",
    },
    {
      id: "schema",
      label: "Schema Validator Lab",
      subtitle: "Catch schema drift before prod does.",
    },
    {
      id: "query",
      label: "Query Optimizer Race",
      subtitle: "Pick the faster plan under pressure.",
    },
    {
      id: "crypto",
      label: "Crypto-for-Data Puzzle",
      subtitle: "Decrypt, compare keys, and secure data.",
    },
  ];

  function buildWorldButtons() {
    const grid = document.getElementById("world-grid");
    grid.innerHTML = "";
    worldDefinitions.forEach((w, idx) => {
      const btn = document.createElement("button");
      btn.className = "world-btn";
      if (w.id === appState.currentWorldId) btn.classList.add("active");
      btn.dataset.worldId = w.id;

      const status = document.createElement("div");
      status.className = "world-status";
      const meta = appState.worlds[w.id];
      if (meta.completed) {
        status.textContent = "Cleared";
        status.classList.add("completed");
      } else if (w.id === appState.currentWorldId) {
        status.textContent = "In progress";
        status.classList.add("current");
      } else {
        status.textContent = "Locked in scope";
      }

      btn.innerHTML = `
        <div class="world-name-row">
          <div class="world-name">${idx + 1}. ${w.label}</div>
        </div>
        <div class="world-tagline">${w.subtitle}</div>
      `;
      btn.querySelector(".world-name-row").appendChild(status);

      btn.addEventListener("click", () => moveToWorld(w.id));
      grid.appendChild(btn);
    });
  }

  function markWorldButtonActive(worldId) {
    document.querySelectorAll(".world-btn").forEach(btn => {
      btn.classList.toggle("active", btn.dataset.worldId === worldId);
      const status = btn.querySelector(".world-status");
      const meta = appState.worlds[btn.dataset.worldId];
      status.classList.remove("current","completed");
      if (meta.completed) {
        status.textContent = "Cleared";
        status.classList.add("completed");
      } else if (btn.dataset.worldId === worldId) {
        status.textContent = "In progress";
        status.classList.add("current");
      } else {
        status.textContent = "Locked in scope";
      }
    });
  }

  /****************************************************
   * QUESTION BANKS â€“ LOADED FROM CSV ONLY
   * All questions are loaded from ALL_QUESTIONS_MASTER.csv
   * No hardcoded fallback questions - CSV is required
   ****************************************************/
  
  // REMOVED: All hardcoded question arrays (escapeQuestions, mlSteps, 
  // promptQuestions, chainQuestions, cleaningQuestions, schemaQuestions,
  // queryQuestions, cryptoQuestions) have been removed.
  // Questions are now loaded exclusively from ALL_QUESTIONS_MASTER.csv
  
  // Questions loaded from CSV - see loadQuestionsFromCSV()

  function generateSessionQuestions(worldId) {
    // ONLY use CSV questions - no fallback to hardcoded questions
    let all = appState.csvQuestions[worldId] || [];
    
    if (all.length === 0) {
      console.error(`âŒ No questions loaded for world: ${worldId}. Check CSV file.`);
      return [];
    }
    
    // Initialize used questions tracking for this world if not exists
    if (!appState.usedQuestions[worldId]) {
      appState.usedQuestions[worldId] = new Set();
    }
    
    // Get the set of used question indices
    const usedSet = appState.usedQuestions[worldId];
    
    // If we've used all questions, reset the tracking (start fresh cycle)
    if (usedSet.size >= all.length - 2) { // Keep buffer of 2 to ensure we can always pick 3
      console.log(`ðŸ”„ Resetting question pool for ${worldId} - all questions have been shown`);
      usedSet.clear();
    }
    
    // Filter out already-used questions
    const availableQuestions = all.filter((q, idx) => !usedSet.has(idx));
    
    // Shuffle available questions for randomness
    const shuffledAvailable = shuffle([...availableQuestions]);
    
    const difficulty = getDifficultyLevel();
    let pool = shuffledAvailable.filter(q => q.difficulty === difficulty);
    
    // If we don't have enough questions of the target difficulty, add more
    if (pool.length < 3) {
      const extras = shuffledAvailable.filter(q => !pool.includes(q));
      pool = pool.concat(extras);
    }
    
    // Take exactly 3 questions
    const selected = pool.slice(0, 3);
    
    // Mark these questions as used (find their original indices)
    selected.forEach(selectedQ => {
      const originalIdx = all.findIndex(q => 
        q.question === selectedQ.question && 
        q.correctIndex === selectedQ.correctIndex
      );
      if (originalIdx !== -1) {
        usedSet.add(originalIdx);
      }
    });
    
    // Save to localStorage for persistence across sessions
    saveUsedQuestionsToStorage();
    
    console.log(`ðŸ“‹ ${worldId}: Selected ${selected.length} questions, ${usedSet.size}/${all.length} total used`);
    
    return selected;
  }

  /****************************************************
   * WORLD-SPECIFIC STATE
   ****************************************************/

  let escapeState = {
    sessionQuestions: [],
    currentIndex: 0,
    locksCleared: 0,
    totalLocks: 3,
    feedback: "",
    answered: false,
  };

  let mlState = {
    sessionQuestions: [],
    currentIndex: 0,
    failure: false,
    feedback: "",
    answered: false,
  };

  let promptState = {
    sessionQuestions: [],
    currentIndex: 0,
    feedback: "",
    answered: false,
  };

  let chainState = {
    sessionQuestions: [],
    currentIndex: 0,
    feedback: "",
    answered: false,
  };

  let cleanState = {
    sessionQuestions: [],
    currentIndex: 0,
    feedback: "",
    answered: false,
  };

  let schemaState = {
    sessionQuestions: [],
    currentIndex: 0,
    feedback: "",
    answered: false,
  };

  let queryState = {
    sessionQuestions: [],
    currentIndex: 0,
    feedback: "",
    answered: false,
  };

  let cryptoState = {
    sessionQuestions: [],
    currentIndex: 0,
    feedback: "",
    answered: false,
  };

  /****************************************************
   * ESCAPE ROOM â€“ 3-QUESTION / 3-LOCK SESSION
   ****************************************************/
  function startEscapeTimer() {
    const timerState = appState.timers.escape;
    if (timerState.intervalId) clearInterval(timerState.intervalId);
    timerState.secondsLeft = 45;
    timerState.intervalId = setInterval(() => {
      timerState.secondsLeft -= 1;
      renderEscapeWorld(); // re-render timer
      if (timerState.secondsLeft <= 0) {
        clearInterval(timerState.intervalId);
        timerState.intervalId = null;
        escapeState.feedback = "Timeâ€™s up. Room resets. Try again.";
        resetEscapeWorld();
      }
    }, 1000);
  }

  function handleEscapeAnswer(optionIndex) {
    if (appState.gameWon || appState.worlds.escape.completed) return;
    const currentQuestion = escapeState.sessionQuestions[escapeState.currentIndex];
    if (!currentQuestion) return;
    
    // Prevent multiple clicks on the same question
    if (escapeState.answered) return;
    escapeState.answered = true;
    
    const isCorrect = optionIndex === currentQuestion.correctIndex;

    const targetLocks = Math.min(
      escapeState.totalLocks,
      escapeState.sessionQuestions.length || escapeState.totalLocks
    );

    if (isCorrect) {
      playSound('correct');
      escapeState.locksCleared += 1;
      appState.score += 10;
      showScorePopup(10, true);
      escapeState.feedback = "âœ… Lock released. Door segment unlocked.";
      escapeState.currentIndex += 1;
      escapeState.answered = false; // Reset for next question

      if (escapeState.locksCleared >= targetLocks) {
        playSound('win');
        escapeState.feedback = "ðŸŽ‰ All locks cleared. World stabilized.";
        appState.worlds.escape.completed = true;

        if (appState.timers.escape.intervalId) {
          clearInterval(appState.timers.escape.intervalId);
          appState.timers.escape.intervalId = null;
        }
        checkGlobalWin();
      }
    } else {
      playSound('wrong');
      escapeState.feedback = "âŒ Incorrect sequence. The door re-locks slightly.";
      const penalty = 3;
      appState.score = Math.max(0, appState.score - penalty);
      showScorePopup(-penalty, false);
      escapeState.answered = false; // Allow retry on wrong answer
    }
    updateGlobalHUD();
    buildWorldButtons();
    renderEscapeWorld();
  }

  function resetEscapeWorld(skipRender) {
    escapeState.sessionQuestions = [];
    escapeState.currentIndex = 0;
    escapeState.locksCleared = 0;
    escapeState.feedback = "";
    escapeState.answered = false;
    appState.worlds.escape.completed = false;
    if (!skipRender) {
      buildWorldButtons();
      renderEscapeWorld();
      startEscapeTimer();
    }
  }

  function renderEscapeWorld() {
    const container = document.getElementById("world-content");
    const timerState = appState.timers.escape;

    if (!escapeState.sessionQuestions || escapeState.sessionQuestions.length === 0) {
      escapeState.sessionQuestions = generateSessionQuestions("escape");
      escapeState.currentIndex = 0;
      escapeState.locksCleared = 0;
      escapeState.feedback = "";
    }

    const q =
      escapeState.sessionQuestions[
        Math.min(escapeState.currentIndex, escapeState.sessionQuestions.length - 1)
      ];

    document.getElementById("world-title").textContent = "AI Escape Room";
    document.getElementById("world-caption").textContent =
      "Unlock the AI control room by answering fundamentals under a soft timer.";
    document.getElementById("world-badge-primary").textContent = "AI Fundamentals";
    document.getElementById("world-badge-secondary").textContent = "Timed Â· 3 locks";

    const targetLocks = Math.min(
      escapeState.totalLocks,
      escapeState.sessionQuestions.length || escapeState.totalLocks
    );

    const locks = Array.from({ length: targetLocks }).map((_, idx) => {
      let cls = "lock-pill";
      if (idx < escapeState.locksCleared) cls += " completed";
      if (idx === escapeState.locksCleared && !appState.worlds.escape.completed) {
        cls += " current";
      }
      return `<div class="${cls}"></div>`;
    }).join("");

    const feedbackHtml = escapeState.feedback
      ? `<div class="feedback ${
          appState.worlds.escape.completed || escapeState.feedback.includes("Lock")
            ? "positive"
            : "negative"
        }">${escapeState.feedback}</div>`
      : "";

    const timerHtml = timerState.intervalId
      ? `<span class="timer">â± ${String(timerState.secondsLeft).padStart(2, "0")}s</span>`
      : `<span class="timer">â± Paused</span>`;

    const isCompleted = appState.worlds.escape.completed || appState.gameWon;
    const optionsHtml = q
      ? q.options
          .map(
            (opt, idx) => `
              <button class="option-btn ${isCompleted ? 'disabled' : ''}" data-option-index="${idx}">
                <div><span class="option-label">${String.fromCharCode(
                  65 + idx
                )}.</span> ${opt}</div>
              </button>
            `
          )
          .join("")
      : "<div class='small-label'>No questions available.</div>";



    container.innerHTML = `
      <div class="card">
        <div class="card-header-row">
          <div>
            <div class="card-title">Lock Sequence</div>
            <div class="card-sub">Answer correctly to unlock the digital door.</div>
          </div>
          <div class="locks-row">${locks}</div>
        </div>
        <div class="divider"></div>
        <div class="question-area">
          <div class="question-text">${q ? q.question : "Session not initialized."}</div>
          <div class="help-text">Select the most accurate description.</div>
          <div class="options-list">
            ${optionsHtml}
          </div>
          ${feedbackHtml}
        </div>
        <div class="state-row">
          <div class="state-left">
            <button class="ghost-btn" id="escape-reset-btn">Reset Room</button>
            <span class="small-label">Locks cleared: ${escapeState.locksCleared} / ${
              targetLocks
            }</span>
          </div>
          <div class="state-right">
            ${timerHtml}
          </div>
        </div>
      </div>
    `;

    container
      .querySelectorAll(".option-btn")
      .forEach(btn =>
        btn.addEventListener("click", () =>
          handleEscapeAnswer(Number(btn.dataset.optionIndex))
        )
      );

    const resetBtn = document.getElementById("escape-reset-btn");
    resetBtn.addEventListener("click", () => {
      resetEscapeWorld();
      startEscapeTimer();
    });
  }

  /****************************************************
   * ML MODEL BUILDER â€“ 3-QUESTION SESSION
   ****************************************************/
  function handleMLDecision(optionIndex) {
    if (appState.gameWon || appState.worlds.mlbuilder.completed) return;
    if (!mlState.sessionQuestions || mlState.sessionQuestions.length === 0) return;

    // Prevent multiple clicks on the same question
    if (mlState.answered) return;
    mlState.answered = true;

    const step = mlState.sessionQuestions[
      Math.min(mlState.currentIndex, mlState.sessionQuestions.length - 1)
    ];
    const isCorrect = optionIndex === step.correctIndex;
    if (isCorrect) {
      playSound('correct');
      appState.score += 15;
      showScorePopup(15, true);
      mlState.failure = false;
      mlState.feedback = "âœ… " + step.positive;
      mlState.currentIndex += 1;
      mlState.answered = false; // Reset for next question
      if (mlState.currentIndex >= mlState.sessionQuestions.length) {
        playSound('win');
        appState.worlds.mlbuilder.completed = true;
        mlState.feedback = "ðŸŽ‰ Pipeline validated. Model is deployment-ready.";
        checkGlobalWin();
      }
    } else {
      playSound('wrong');
      mlState.failure = true;
      mlState.feedback = "âŒ " + step.negative;
      const penalty = 5;
      appState.score = Math.max(0, appState.score - penalty);
      showScorePopup(-penalty, false);
      mlState.answered = false; // Allow retry on wrong answer
    }
    updateGlobalHUD();
    buildWorldButtons();
    renderMLWorld();
  }

  function resetMLWorld(skipRender) {
    mlState.sessionQuestions = [];
    mlState.currentIndex = 0;
    mlState.failure = false;
    mlState.feedback = "";
    mlState.answered = false;
    appState.worlds.mlbuilder.completed = false;
    if (!skipRender) {
      buildWorldButtons();
      renderMLWorld();
    }
  }

  function renderMLWorld() {
    const container = document.getElementById("world-content");

    if (!mlState.sessionQuestions || mlState.sessionQuestions.length === 0) {
      mlState.sessionQuestions = generateSessionQuestions("mlbuilder");
      mlState.currentIndex = 0;
      mlState.failure = false;
      mlState.feedback = "";
    }

    const stepCount = mlState.sessionQuestions.length;
    const step =
      mlState.sessionQuestions[
        Math.min(mlState.currentIndex, Math.max(stepCount - 1, 0))
      ];

    document.getElementById("world-title").textContent = "ML Model Builder";
    document.getElementById("world-caption").textContent =
      "Walk a real model lifecycle: clean, choose, regularize, and ship.";
    document.getElementById("world-badge-primary").textContent = "ML Lifecycle";
    document.getElementById("world-badge-secondary").textContent =
      "Scenario Â· Step-based";

    const pipelineStatus = mlState.failure
      ? "FAILED â€“ Metrics out of bounds"
      : appState.worlds.mlbuilder.completed
      ? "STABLE â€“ Ready for deployment"
      : "IN DESIGN â€“ Still tuning";

    const feedbackHtml = mlState.feedback
      ? `<div class="feedback ${mlState.failure ? "negative" : "positive"}">${
          mlState.feedback
        }</div>`
      : "";

    const isCompleted = appState.worlds.mlbuilder.completed;
    const optionsHtml = step
      ? step.options
          .map(
            (opt, idx) => `
              <button class="option-btn ${isCompleted ? 'disabled' : ''}" data-option-index="${idx}">
                <div><span class="option-label">${String.fromCharCode(
                  65 + idx
                )}.</span> ${opt}</div>
                
              </button>
            `
          )
          .join("")
      : "<div class='small-label'>No ML steps configured.</div>";

    const isFinished = appState.worlds.mlbuilder.completed;

    container.innerHTML = `
      <div class="card">
        <div class="card-header-row">
          <div>
            <div class="card-title">Design Decisions</div>
            <div class="card-sub">
              Build a resilient pipeline by picking the right intervention at each step.
            </div>
          </div>
          <span class="pill-small">Question ${
            Math.min(mlState.currentIndex + 1, stepCount)
          } of ${stepCount}</span>
        </div>
        <div class="divider"></div>
        <div class="question-area">
          <div class="question-text">${
            step ? `${step.label} â€“ ${step.question}` : "Session not initialized."
          }</div>
          <div class="options-list">
            ${optionsHtml}
          </div>
          ${feedbackHtml}
        </div>
        <div class="state-row">
          <div class="state-left">
            <button class="ghost-btn" id="ml-reset-btn">Reset Pipeline</button>
            <span class="small-label">Status: ${pipelineStatus}</span>
          </div>
          <div class="state-right">
            <span class="small-label">Overfitting risk Â· ${
              mlState.failure ? "HIGH" : "CONTROLLED"
            }</span>
          </div>
        </div>
      </div>
    `;

    container
      .querySelectorAll(".option-btn")
      .forEach(btn =>
        btn.addEventListener("click", () =>
          handleMLDecision(Number(btn.dataset.optionIndex))
        )
      );

    document
      .getElementById("ml-reset-btn")
      .addEventListener("click", () => resetMLWorld());
  }

  /****************************************************
   * PROMPT ARENA â€“ 3-QUESTION SESSION
   ****************************************************/
  function handlePromptAnswer(optionIndex) {
    if (appState.gameWon || appState.worlds.prompt.completed) return;
    
    // Prevent multiple clicks on the same question
    if (promptState.answered) return;
    promptState.answered = true;
    if (!promptState.sessionQuestions || promptState.sessionQuestions.length === 0)
      return;

    const q =
      promptState.sessionQuestions[
        Math.min(
          promptState.currentIndex,
          Math.max(promptState.sessionQuestions.length - 1, 0)
        )
      ];
    const isCorrect = optionIndex === q.correctIndex;
    if (isCorrect) {
      playSound('correct');
      appState.score += 10;
      showScorePopup(10, true);
      promptState.feedback = "âœ… Prompt upgraded. Model output quality improves.";
      promptState.currentIndex += 1;
      promptState.answered = false; // Reset for next question
      if (promptState.currentIndex >= promptState.sessionQuestions.length) {
        playSound('win');
        appState.worlds.prompt.completed = true;
        promptState.feedback = "ðŸŽ‰ Arena cleared. Youâ€™re now prompt-ops certified.";
        checkGlobalWin();
      }
    } else {
      playSound('wrong');
      const penalty = 4;
      appState.score = Math.max(0, appState.score - penalty);
      showScorePopup(-penalty, false);
      promptState.feedback = "âŒ Ambiguous prompt. Output quality degrades.";
      promptState.answered = false; // Allow retry on wrong answer
    }
    updateGlobalHUD();
    buildWorldButtons();
    renderPromptWorld();
  }

  function resetPromptWorld(skipRender) {
    promptState.sessionQuestions = [];
    promptState.currentIndex = 0;
    promptState.feedback = "";
    promptState.answered = false;
    appState.worlds.prompt.completed = false;
    if (!skipRender) {
      buildWorldButtons();
      renderPromptWorld();
    }
  }

  function renderPromptWorld() {
    const container = document.getElementById("world-content");

    if (!promptState.sessionQuestions || promptState.sessionQuestions.length === 0) {
      promptState.sessionQuestions = generateSessionQuestions("prompt");
      promptState.currentIndex = 0;
      promptState.feedback = "";
    }

    const qCount = promptState.sessionQuestions.length;
    const q =
      promptState.sessionQuestions[
        Math.min(promptState.currentIndex, Math.max(qCount - 1, 0))
      ];

    document.getElementById("world-title").textContent = "GenAI Prompt Arena";
    document.getElementById("world-caption").textContent =
      "Battle weak prompts and design instructions that ship reliable outputs.";
    document.getElementById("world-badge-primary").textContent = "Prompt Engineering";
    document.getElementById("world-badge-secondary").textContent =
      "Quality Â· Safety";

    const feedbackHtml = promptState.feedback
      ? `<div class="feedback ${
          promptState.feedback.includes("upgraded") ||
          promptState.feedback.includes("certified")
            ? "positive"
            : "negative"
        }">${promptState.feedback}</div>`
      : "";

    const isCompleted = appState.worlds.prompt.completed || appState.gameWon;
    const optionsHtml = q
      ? q.options
          .map(
            (opt, idx) => `
              <button class="option-btn ${isCompleted ? 'disabled' : ''}" data-option-index="${idx}">
                <div><span class="option-label">${String.fromCharCode(
                  65 + idx
                )}.</span> ${opt}</div>
                
              </button>
            `
          )
          .join("")
      : "<div class='small-label'>No prompt questions configured.</div>";

    container.innerHTML = `
      <div class="card">
        <div class="card-header-row">
          <div>
            <div class="card-title">Prompt Duel</div>
            <div class="card-sub">${q ? q.title : "Session not initialized."}</div>
          </div>
          <span class="pill-small">Question ${
            Math.min(promptState.currentIndex + 1, qCount)
          } of ${qCount}</span>
        </div>
        <div class="divider"></div>
        <div class="question-area">
          <div class="question-text" style="white-space:pre-line;">${
            q ? q.question : ""
          }</div>
          <div class="options-list">
            ${optionsHtml}
          </div>
          ${feedbackHtml}
        </div>
      </div>
    `;

    container
      .querySelectorAll(".option-btn")
      .forEach(btn =>
        btn.addEventListener("click", () =>
          handlePromptAnswer(Number(btn.dataset.optionIndex))
        )
      );
  }

  /****************************************************
   * BLOCKCHAIN HASH HUNT â€“ 3-QUESTION SESSION
   ****************************************************/
  function handleChainAnswer(optionIndex) {
    if (appState.gameWon || appState.worlds.chain.completed) return;
    
    // Prevent multiple clicks on the same question
    if (chainState.answered) return;
    chainState.answered = true;
    
    if (!chainState.sessionQuestions || chainState.sessionQuestions.length === 0)
      return;

    const q =
      chainState.sessionQuestions[
        Math.min(chainState.currentIndex, Math.max(chainState.sessionQuestions.length - 1, 0))
      ];
    const isCorrect = optionIndex === q.correctIndex;
    if (isCorrect) {
      playSound('correct');
      appState.score += 10;
      showScorePopup(10, true);
      chainState.feedback = "âœ… Hash validated. Chain segment secured.";
      chainState.currentIndex += 1;
      chainState.answered = false; // Reset for next question
      if (chainState.currentIndex >= chainState.sessionQuestions.length) {
        playSound('win');
        appState.worlds.chain.completed = true;
        chainState.feedback = "ðŸŽ‰ All blocks verified. Ledger is stable.";
        checkGlobalWin();
      }
    } else {
      playSound('wrong');
      const penalty = 4;
      appState.score = Math.max(0, appState.score - penalty);
      showScorePopup(-penalty, false);
      chainState.feedback = "âŒ Invalid choice. Integrity alarm triggered.";
      chainState.answered = false; // Allow retry on wrong answer
    }
    updateGlobalHUD();
    buildWorldButtons();
    renderChainWorld();
  }

  function resetChainWorld(skipRender) {
    chainState.sessionQuestions = [];
    chainState.currentIndex = 0;
    chainState.feedback = "";
    chainState.answered = false;
    appState.worlds.chain.completed = false;
    if (!skipRender) {
      buildWorldButtons();
      renderChainWorld();
    }
  }

  function renderChainWorld() {
    const container = document.getElementById("world-content");

    if (!chainState.sessionQuestions || chainState.sessionQuestions.length === 0) {
      chainState.sessionQuestions = generateSessionQuestions("chain");
      chainState.currentIndex = 0;
      chainState.feedback = "";
    }

    const qCount = chainState.sessionQuestions.length;
    const q =
      chainState.sessionQuestions[
        Math.min(chainState.currentIndex, Math.max(qCount - 1, 0))
      ];

    document.getElementById("world-title").textContent = "Blockchain Hash Hunt";
    document.getElementById("world-caption").textContent =
      "Validate hashes, select consensus, and keep the ledger clean.";
    document.getElementById("world-badge-primary").textContent = "Blockchain Basics";
    document.getElementById("world-badge-secondary").textContent =
      "Integrity Â· Consensus";

    const feedbackHtml = chainState.feedback
      ? `<div class="feedback ${
          chainState.feedback.includes("validated") ||
          chainState.feedback.includes("stable")
            ? "positive"
            : "negative"
        }">${chainState.feedback}</div>`
      : "";

    const sampleHash =
      "000000ab94c3f2b38174f5086e22e7b9fb305f615e7a483920c7aa12f";

    const isCompleted = appState.worlds.chain.completed || appState.gameWon;
    const optionsHtml = q
      ? q.options
          .map(
            (opt, idx) => `
              <button class="option-btn ${isCompleted ? 'disabled' : ''}" data-option-index="${idx}">
                <div><span class="option-label">${String.fromCharCode(
                  65 + idx
                )}.</span> ${opt}</div>
                
              </button>
            `
          )
          .join("")
      : "<div class='small-label'>No blockchain questions configured.</div>";

    container.innerHTML = `
      <div class="card">
        <div class="card-header-row">
          <div>
            <div class="card-title">Hash Puzzle</div>
            <div class="card-sub">Spot invalid segments and lock the ledger.</div>
          </div>
          <span class="pill-small">Question ${
            Math.min(chainState.currentIndex + 1, qCount)
          } of ${qCount}</span>
        </div>
        <div class="divider"></div>
        <div class="question-area">
          <div class="hash-row">hash: <strong>${sampleHash}</strong></div>
          <div class="question-text">${q ? q.question : "Session not initialized."}</div>
          <div class="options-list">
            ${optionsHtml}
          </div>
          ${feedbackHtml}
        </div>
      </div>
    `;

    container
      .querySelectorAll(".option-btn")
      .forEach(btn =>
        btn.addEventListener("click", () =>
          handleChainAnswer(Number(btn.dataset.optionIndex))
        )
      );
  }

  /****************************************************
   * DATA CLEANING NINJA â€“ 3-QUESTION SESSION
   ****************************************************/
  function handleCleanAnswer(optionIndex) {
    if (appState.gameWon || appState.worlds.clean.completed) return;
    if (!cleanState.sessionQuestions || cleanState.sessionQuestions.length === 0)
      return;

    const q =
      cleanState.sessionQuestions[
        Math.min(cleanState.currentIndex, Math.max(cleanState.sessionQuestions.length - 1, 0))
      ];
    const isCorrect = optionIndex === q.correctIndex;
    if (isCorrect) {
      playSound('correct');
      appState.score += 10;
      showScorePopup(10, true);
      cleanState.feedback = "âœ… Dataset quality improved. Downstream models thank you.";
      cleanState.currentIndex += 1;
      if (cleanState.currentIndex >= cleanState.sessionQuestions.length) {
        appState.worlds.clean.completed = true;
        cleanState.feedback = "All key issues resolved. Dataset is production-grade.";
        checkGlobalWin();
      }
    } else {
      appState.score = Math.max(0, appState.score - 3);
      playSound('wrong');
      showScorePopup(-3, false);
      cleanState.feedback = "Dirty data flows downstream. Youâ€™ve created debt.";
    }
    updateGlobalHUD();
    renderCleanWorld();
  }

  function resetCleanWorld(skipRender) {
    cleanState.sessionQuestions = [];
    cleanState.currentIndex = 0;
    cleanState.feedback = "";
    cleanState.answered = false;
    appState.worlds.clean.completed = false;
    if (!skipRender) {
      buildWorldButtons();
      renderCleanWorld();
    }
  }

  function renderCleanWorld() {
    const container = document.getElementById("world-content");

    if (!cleanState.sessionQuestions || cleanState.sessionQuestions.length === 0) {
      cleanState.sessionQuestions = generateSessionQuestions("clean");
      cleanState.currentIndex = 0;
      cleanState.feedback = "";
    }

    const qCount = cleanState.sessionQuestions.length;
    const q =
      cleanState.sessionQuestions[
        Math.min(cleanState.currentIndex, Math.max(qCount - 1, 0))
      ];

    document.getElementById("world-title").textContent = "Data Cleaning Ninja";
    document.getElementById("world-caption").textContent =
      "Neutralize messy datasets before they reach production pipelines.";
    document.getElementById("world-badge-primary").textContent = "Data Quality";
    document.getElementById("world-badge-secondary").textContent =
      "Dedupe Â· Normalize";

    const feedbackHtml = cleanState.feedback
      ? `<div class="feedback ${
          cleanState.feedback.includes("improved") ||
          cleanState.feedback.includes("production-grade")
            ? "positive"
            : "negative"
        }">${cleanState.feedback}</div>`
      : "";

    const isCompleted = appState.worlds.clean.completed || appState.gameWon;
    const optionsHtml = q
      ? q.options
          .map(
            (opt, idx) => `
              <button class="option-btn ${isCompleted ? 'disabled' : ''}" data-option-index="${idx}">
                <div><span class="option-label">${String.fromCharCode(
                  65 + idx
                )}.</span> ${opt}</div>
                
              </button>
            `
          )
          .join("")
      : "<div class='small-label'>No cleaning questions configured.</div>";

    container.innerHTML = `
      <div class="card">
        <div class="card-header-row">
          <div>
            <div class="card-title">Cleaning Task</div>
            <div class="card-sub">Pick the right action on a messy dataset.</div>
          </div>
          <span class="pill-small">Question ${
            Math.min(cleanState.currentIndex + 1, qCount)
          } of ${qCount}</span>
        </div>
        <div class="divider"></div>
        <div class="question-area">
          <div class="question-text">${q ? q.question : "Session not initialized."}</div>
          <div class="options-list">
            ${optionsHtml}
          </div>
          ${feedbackHtml}
        </div>
      </div>
    `;

    container
      .querySelectorAll(".option-btn")
      .forEach(btn =>
        btn.addEventListener("click", () =>
          handleCleanAnswer(Number(btn.dataset.optionIndex))
        )
      );
  }

  /****************************************************
   * SCHEMA VALIDATOR LAB â€“ 3-QUESTION SESSION
   ****************************************************/
  function handleSchemaAnswer(optionIndex) {
    if (appState.gameWon || appState.worlds.schema.completed) return;
    
    // Prevent multiple clicks on the same question
    if (schemaState.answered) return;
    schemaState.answered = true;
    
    if (!schemaState.sessionQuestions || schemaState.sessionQuestions.length === 0)
      return;

    const q =
      schemaState.sessionQuestions[
        Math.min(schemaState.currentIndex, Math.max(schemaState.sessionQuestions.length - 1, 0))
      ];
    const isCorrect = optionIndex === q.correctIndex;
    if (isCorrect) {
      playSound('correct');
      appState.score += 10;
      showScorePopup(10, true);
      schemaState.feedback =
        "âœ… Schema check passes. Application-layer errors drop immediately.";
      schemaState.currentIndex += 1;
      schemaState.answered = false; // Reset for next question
      if (schemaState.currentIndex >= schemaState.sessionQuestions.length) {
        playSound('win');
        appState.worlds.schema.completed = true;
        schemaState.feedback = "ðŸŽ‰ All constraints aligned. Schema lab stabilized.";
        checkGlobalWin();
      }
    } else {
      playSound('wrong');
      appState.score = Math.max(0, appState.score - 3);
      showScorePopup(-3, false);
      schemaState.feedback =
        "âŒ Hidden schema drift introduced. Production incidents spike.";
      schemaState.answered = false; // Allow retry on wrong answer
    }
    updateGlobalHUD();
    buildWorldButtons();
    renderSchemaWorld();
  }

  function resetSchemaWorld(skipRender) {
    schemaState.sessionQuestions = [];
    schemaState.currentIndex = 0;
    schemaState.feedback = "";
    appState.worlds.schema.completed = false;
    if (!skipRender) {
      buildWorldButtons();
      renderSchemaWorld();
    }
  }

  function renderSchemaWorld() {
    const container = document.getElementById("world-content");

    if (!schemaState.sessionQuestions || schemaState.sessionQuestions.length === 0) {
      schemaState.sessionQuestions = generateSessionQuestions("schema");
      schemaState.currentIndex = 0;
      schemaState.feedback = "";
    }

    const qCount = schemaState.sessionQuestions.length;
    const q =
      schemaState.sessionQuestions[
        Math.min(schemaState.currentIndex, Math.max(qCount - 1, 0))
      ];

    document.getElementById("world-title").textContent = "Schema Validator Lab";
    document.getElementById("world-caption").textContent =
      "Catch mismatches between expectations and reality before they hit production.";
    document.getElementById("world-badge-primary").textContent = "Data Contracts";
    document.getElementById("world-badge-secondary").textContent =
      "PK/FK Â· Nullability";

    const feedbackHtml = schemaState.feedback
      ? `<div class="feedback ${
          schemaState.feedback.includes("passes") ||
          schemaState.feedback.includes("stabilized")
            ? "positive"
            : "negative"
        }">${schemaState.feedback}</div>`
      : "";

    const isCompleted = appState.worlds.schema.completed || appState.gameWon;
    const optionsHtml = q
      ? q.options
          .map(
            (opt, idx) => `
              <button class="option-btn ${isCompleted ? 'disabled' : ''}" data-option-index="${idx}">
                <div><span class="option-label">${String.fromCharCode(
                  65 + idx
                )}.</span> ${opt}</div>
                
              </button>
            `
          )
          .join("")
      : "<div class='small-label'>No schema questions configured.</div>";

    container.innerHTML = `
      <div class="card">
        <div class="card-header-row">
          <div>
            <div class="card-title">Schema Check</div>
            <div class="card-sub">Identify the constraint that is being violated.</div>
          </div>
          <span class="pill-small">Question ${
            Math.min(schemaState.currentIndex + 1, qCount)
          } of ${qCount}</span>
        </div>
        <div class="divider"></div>
        <div class="question-area">
          <div class="question-text">${q ? q.question : "Session not initialized."}</div>
          <div class="options-list">
            ${optionsHtml}
          </div>
          ${feedbackHtml}
        </div>
      </div>
    `;

    container
      .querySelectorAll(".option-btn")
      .forEach(btn =>
        btn.addEventListener("click", () =>
          handleSchemaAnswer(Number(btn.dataset.optionIndex))
        )
      );
  }

  /****************************************************
   * QUERY OPTIMIZER RACE â€“ 3-QUESTION SESSION
   ****************************************************/
  function handleQueryAnswer(optionIndex) {    if (appState.gameWon || appState.worlds.query.completed) return;
    if (!queryState.sessionQuestions || queryState.sessionQuestions.length === 0)
      return;

    const q =
      queryState.sessionQuestions[
        Math.min(queryState.currentIndex, Math.max(queryState.sessionQuestions.length - 1, 0))
      ];
    const isCorrect = optionIndex === q.correctIndex;
    if (isCorrect) {
      playSound('correct');
      appState.score += 12;
      showScorePopup(12, true);
      queryState.feedback = "âœ… Boost! Execution plan streamlined.";
      queryState.currentIndex += 1;
      if (queryState.currentIndex >= queryState.sessionQuestions.length) {
        appState.worlds.query.completed = true;
        queryState.feedback = "Race won. Query fleet fully optimized.";
        checkGlobalWin();
      }
    } else {
      appState.score = Math.max(0, appState.score - 5);     showScorePopup(-5, false);     queryState.feedback = "Engine stalls. The optimizer canâ€™t rescue a bad pattern.";
    }
    updateGlobalHUD();
    renderQueryWorld();
  }

  function resetQueryWorld(skipRender) {
    queryState.sessionQuestions = [];
    queryState.currentIndex = 0;
    queryState.feedback = "";
    queryState.answered = false;
    appState.worlds.query.completed = false;
    if (!skipRender) {
      buildWorldButtons();
      renderQueryWorld();
    }
  }

  function renderQueryWorld() {
    const container = document.getElementById("world-content");

    if (!queryState.sessionQuestions || queryState.sessionQuestions.length === 0) {
      queryState.sessionQuestions = generateSessionQuestions("query");
      queryState.currentIndex = 0;
      queryState.feedback = "";
    }

    const qCount = queryState.sessionQuestions.length;
    const q =
      queryState.sessionQuestions[
        Math.min(queryState.currentIndex, Math.max(qCount - 1, 0))
      ];

    document.getElementById("world-title").textContent = "Query Optimizer Race";
    document.getElementById("world-caption").textContent =
      "Pick the faster query under race conditions and monitor the plan.";
    document.getElementById("world-badge-primary").textContent = "SQL Performance";
    document.getElementById("world-badge-secondary").textContent =
      "Indexes Â· Joins";

    const feedbackHtml = queryState.feedback
      ? `<div class="feedback ${
          queryState.feedback.includes("Boost") ||
          queryState.feedback.includes("Race won")
            ? "positive"
            : "negative"
        }">${queryState.feedback}</div>`
      : "";

      const isCompleted = appState.worlds.query.completed || appState.gameWon;
      const optionsHtml = q
        ? q.options
            .map(
              (opt, idx) => `
                <button class="option-btn ${isCompleted ? 'disabled' : ''}" data-option-index="${idx}">
                  <div>
                    <div><span class="option-label">Q${idx + 1}.</span> ${opt}</div>
                    <div class="small-label">${q.labels && q.labels[idx] ? q.labels[idx] : ""}</div>
                  </div>
                </button>
              `
            )
            .join("")
        : "<div class='small-label'>No query questions configured.</div>";

    container.innerHTML = `
      <div class="card">
        <div class="card-header-row">
          <div>
            <div class="card-title">Race Segment</div>
            <div class="card-sub">Two queries. One leaderboard.</div>
          </div>
          <span class="pill-small">Question ${
            Math.min(queryState.currentIndex + 1, qCount)
          } of ${qCount}</span>
        </div>
        <div class="divider"></div>
        <div class="question-area">
          <div class="question-text">${q ? q.question : "Session not initialized."}</div>
          <div class="options-list">
            ${optionsHtml}
          </div>
          ${feedbackHtml}
        </div>
      </div>
    `;

    container
      .querySelectorAll(".option-btn")
      .forEach(btn =>
        btn.addEventListener("click", () =>
          handleQueryAnswer(Number(btn.dataset.optionIndex))
        )
      );
  }

  /****************************************************
   * CRYPTO-FOR-DATA PUZZLE â€“ 3-QUESTION SESSION
   ****************************************************/
  function handleCryptoAnswer(optionIndex) {
    if (appState.gameWon || appState.worlds.crypto.completed) return;
    
    // Prevent multiple clicks on the same question
    if (cryptoState.answered) return;
    cryptoState.answered = true;
    
    if (!cryptoState.sessionQuestions || cryptoState.sessionQuestions.length === 0)
      return;

    const q =
      cryptoState.sessionQuestions[
        Math.min(cryptoState.currentIndex, Math.max(cryptoState.sessionQuestions.length - 1, 0))
      ];
    const isCorrect = optionIndex === q.correctIndex;
    if (isCorrect) {
      playSound('correct');
      appState.score += 10;
      showScorePopup(10, true);
      cryptoState.feedback = "âœ… Cipher cracked. Message integrity restored.";
      cryptoState.currentIndex += 1;
      cryptoState.answered = false; // Reset for next question
      if (cryptoState.currentIndex >= cryptoState.sessionQuestions.length) {
        playSound('win');
        appState.worlds.crypto.completed = true;
        cryptoState.feedback = "ðŸŽ‰ All crypto puzzles cleared. Data vault is secure.";
        checkGlobalWin();
      }
    } else {
      playSound('wrong');
      appState.score = Math.max(0, appState.score - 4);
      showScorePopup(-4, false);
      cryptoState.feedback =
        "âŒ Incorrect. The attacker gains signal on your mental model.";
      cryptoState.answered = false; // Allow retry on wrong answer
    }
    updateGlobalHUD();
    buildWorldButtons();
    renderCryptoWorld();
  }

  function resetCryptoWorld(skipRender) {
    cryptoState.sessionQuestions = [];
    cryptoState.currentIndex = 0;
    cryptoState.feedback = "";
    appState.worlds.crypto.completed = false;
    if (!skipRender) {
      buildWorldButtons();
      renderCryptoWorld();
    }
  }

  function renderCryptoWorld() {
    const container = document.getElementById("world-content");

    if (!cryptoState.sessionQuestions || cryptoState.sessionQuestions.length === 0) {
      cryptoState.sessionQuestions = generateSessionQuestions("crypto");
      cryptoState.currentIndex = 0;
      cryptoState.feedback = "";
    }

    const qCount = cryptoState.sessionQuestions.length;
    const q =
      cryptoState.sessionQuestions[
        Math.min(cryptoState.currentIndex, Math.max(qCount - 1, 0))
      ];

    document.getElementById("world-title").textContent = "Crypto-for-Data Puzzle";
    document.getElementById("world-caption").textContent =
      "Play with basic ciphers and security concepts to keep the data vault intact.";
    document.getElementById("world-badge-primary").textContent = "Crypto Basics";
    document.getElementById("world-badge-secondary").textContent =
      "Keys Â· Hashes";

    const feedbackHtml = cryptoState.feedback
      ? `<div class="feedback ${
          cryptoState.feedback.includes("cracked") ||
          cryptoState.feedback.includes("secure")
            ? "positive"
            : "negative"
        }">${cryptoState.feedback}</div>`
      : "";

    const toyCipher = "KHOOR â†’ HELLO (Caesar +3)";

    const isCompleted = appState.worlds.crypto.completed || appState.gameWon;
    const optionsHtml = q
      ? q.options
          .map(
            (opt, idx) => `
              <button class="option-btn ${isCompleted ? 'disabled' : ''}" data-option-index="${idx}">
                <div><span class="option-label">${String.fromCharCode(
                  65 + idx
                )}.</span> ${opt}</div>
                
              </button>
            `
          )
          .join("")
      : "<div class='small-label'>No crypto questions configured.</div>";

    container.innerHTML = `
      <div class="card">
        <div class="card-header-row">
          <div>
            <div class="card-title">Crypto Question</div>
            <div class="card-sub">Lock in the correct concept.</div>
          </div>
          <span class="pill-small">Question ${
            Math.min(cryptoState.currentIndex + 1, qCount)
          } of ${qCount}</span>
        </div>
        <div class="divider"></div>
        <div class="question-area">
          <div class="hash-row">${toyCipher}</div>
          <div class="question-text">${q ? q.question : "Session not initialized."}</div>
          <div class="options-list">
            ${optionsHtml}
          </div>
          ${feedbackHtml}
        </div>
      </div>
    `;

    container
      .querySelectorAll(".option-btn")
      .forEach(btn =>
        btn.addEventListener("click", () =>
          handleCryptoAnswer(Number(btn.dataset.optionIndex))
        )
      );
  }

  /****************************************************
   * WORLD ROUTING
   ****************************************************/
  function moveToWorld(worldId) {
    // Stop escape timer if switching away from escape room
    if (appState.currentWorldId === "escape" && worldId !== "escape") {
      if (appState.timers.escape.intervalId) {
        clearInterval(appState.timers.escape.intervalId);
        appState.timers.escape.intervalId = null;
      }
    }
    
    appState.currentWorldId = worldId;
    markWorldButtonActive(worldId);
    updateGlobalHUD();

    switch (worldId) {
      case "escape":
        renderEscapeWorld();
        if (!appState.worlds.escape.completed) {
          startEscapeTimer();
        }
        break;
      case "mlbuilder":
        renderMLWorld();
        break;
      case "prompt":
        renderPromptWorld();
        break;
      case "chain":
        renderChainWorld();
        break;
      case "clean":
        renderCleanWorld();
        break;
      case "schema":
        renderSchemaWorld();
        break;
      case "query":
        renderQueryWorld();
        break;
      case "crypto":
        renderCryptoWorld();
        break;
      default:
        renderEscapeWorld();
        if (!appState.worlds.escape.completed) {
          startEscapeTimer();
        }
    }
  }

  /****************************************************
   * FULL GAME RESET â€“ AFTER 3 WORLDS CLEARED
   ****************************************************/
  function resetFullGame() {
    // Reset global score and win flag
    appState.score = 0;
    appState.gameWon = false;

    // NOTE: We do NOT clear usedQuestions here - they persist across sessions
    // Questions will only repeat once the entire pool is exhausted
    // To manually reset question history, call clearUsedQuestionsStorage() from console

    // Reset world meta
    Object.keys(appState.worlds).forEach(id => {
      appState.worlds[id].completed = false;
    });

    // Reset timer
    if (appState.timers.escape.intervalId) {
      clearInterval(appState.timers.escape.intervalId);
      appState.timers.escape.intervalId = null;
    }
    appState.timers.escape.secondsLeft = 45;

    // Reset world states
    resetEscapeWorld(true);
    resetMLWorld(true);
    resetPromptWorld(true);
    resetChainWorld(true);
    resetCleanWorld(true);
    resetSchemaWorld(true);
    resetQueryWorld(true);
    resetCryptoWorld(true);

    buildWorldButtons();
    updateGlobalHUD();
    hideWinModal();
    moveToWorld("escape");
  }

  /****************************************************
   * BOOTSTRAP
   ****************************************************/
  async function bootstrap() {
    // Load used questions history from localStorage (persists across sessions)
    loadUsedQuestionsFromStorage();
    
    // Load questions from CSV first - THIS IS REQUIRED
    await loadQuestionsFromCSV();
    
    // Check if CSV loaded successfully
    if (!appState.csvLoaded) {
      console.error('âŒ Game cannot start without CSV questions');
      document.getElementById("world-content").innerHTML = `
        <div class="card">
          <div class="card-title" style="color: #f97373;">âš ï¸ Error Loading Questions</div>
          <div class="question-text">
            Could not load questions from ALL_QUESTIONS_MASTER.csv.<br><br>
            Please ensure the CSV file is in the same directory as Game.html and refresh the page.
          </div>
        </div>
      `;
      return;
    }
    
    buildWorldButtons();
    updateGlobalHUD();
    moveToWorld("escape");

    const winResetBtn = document.getElementById("win-reset-btn");
    if (winResetBtn) {
      winResetBtn.addEventListener("click", resetFullGame);
    }
  }

  /****************************************************
   * SOUND EFFECTS - Web Audio API (No Installation!)
   ****************************************************/
  const audioContext = new (window.AudioContext || window.webkitAudioContext)();

  function playSound(type) {
    const oscillator = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioContext.destination);
    
    switch(type) {
      case 'correct':
        oscillator.frequency.setValueAtTime(523.25, audioContext.currentTime); // C5
        oscillator.frequency.exponentialRampToValueAtTime(783.99, audioContext.currentTime + 0.1); // G5
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.3);
        break;
      
      case 'wrong':
        oscillator.frequency.setValueAtTime(200, audioContext.currentTime);
        oscillator.frequency.exponentialRampToValueAtTime(100, audioContext.currentTime + 0.2);
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.2);
        break;
      
      case 'win':
        // Victory fanfare
        [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
          const osc = audioContext.createOscillator();
          const gain = audioContext.createGain();
          osc.connect(gain);
          gain.connect(audioContext.destination);
          osc.frequency.setValueAtTime(freq, audioContext.currentTime + i * 0.15);
          gain.gain.setValueAtTime(0.2, audioContext.currentTime + i * 0.15);
          gain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + i * 0.15 + 0.3);
          osc.start(audioContext.currentTime + i * 0.15);
          osc.stop(audioContext.currentTime + i * 0.15 + 0.3);
        });
        break;
      
      case 'click':
        oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
        gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.05);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.05);
        break;
      
      case 'hover':
        oscillator.frequency.setValueAtTime(600, audioContext.currentTime);
        gainNode.gain.setValueAtTime(0.05, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.03);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.03);
        break;
    }
  }

  // Add sound to all buttons
  document.addEventListener('click', (e) => {
    if (e.target.matches('button') || e.target.closest('button')) {
      playSound('click');
    }
  });

  // Add hover sound to option buttons
  document.addEventListener('mouseover', (e) => {
    if (e.target.closest('.option-btn') || e.target.closest('.world-btn')) {
      playSound('hover');
    }
  });

  /****************************************************
   * PARTICLE EFFECTS FOR CORRECT ANSWERS
   ****************************************************/
  function createParticles(x, y) {
    const colors = ['#4ade80', '#22c55e', '#a78bfa', '#fb923c', '#fbbf24'];
    for (let i = 0; i < 15; i++) {
      const particle = document.createElement('div');
      particle.style.position = 'fixed';
      particle.style.left = x + 'px';
      particle.style.top = y + 'px';
      particle.style.width = '8px';
      particle.style.height = '8px';
      particle.style.borderRadius = '50%';
      particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
      particle.style.pointerEvents = 'none';
      particle.style.zIndex = '9999';
      particle.style.boxShadow = '0 0 10px currentColor';
      
      document.body.appendChild(particle);
      
      const angle = (Math.PI * 2 * i) / 15;
      const velocity = 100 + Math.random() * 100;
      const vx = Math.cos(angle) * velocity;
      const vy = Math.sin(angle) * velocity;
      
      let posX = x;
      let posY = y;
      let opacity = 1;
      
      const animate = () => {
        posX += vx * 0.016;
        posY += vy * 0.016 + 2;
        opacity -= 0.02;
        
        particle.style.left = posX + 'px';
        particle.style.top = posY + 'px';
        particle.style.opacity = opacity;
        
        if (opacity > 0) {
          requestAnimationFrame(animate);
        } else {
          particle.remove();
        }
      };
      
      requestAnimationFrame(animate);
    }
  }

  // Add particle effect on correct answers and shake on wrong
  document.addEventListener('click', (e) => {
    if (e.target.closest('.option-btn')) {
      setTimeout(() => {
        const feedbackPositive = document.querySelector('.feedback.positive');
        const feedbackNegative = document.querySelector('.feedback.negative');
        
        if (feedbackPositive) {
          const rect = e.target.getBoundingClientRect();
          createParticles(rect.left + rect.width / 2, rect.top + rect.height / 2);
          
          // Add bounce to score
          const scoreDisplay = document.getElementById('score-display');
          if (scoreDisplay) {
            scoreDisplay.classList.add('bounce-animation');
            setTimeout(() => scoreDisplay.classList.remove('bounce-animation'), 600);
          }
        }
        
        if (feedbackNegative) {
          // Shake the world-main container
          const worldMain = document.querySelector('.world-main');
          if (worldMain) {
            worldMain.style.animation = 'none';
            setTimeout(() => {
              worldMain.style.animation = 'shake 0.5s ease';
              setTimeout(() => {
                worldMain.style.animation = 'slide-up 0.6s ease';
              }, 500);
            }, 10);
          }
        }
      }, 100);
    }
  });

  bootstrap();
</script>
</body>
</html>